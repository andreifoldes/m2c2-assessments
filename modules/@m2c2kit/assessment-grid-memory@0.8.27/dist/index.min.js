import{Game as ee,Sprite as te,Scene as N,WebColors as l,LabelHorizontalAlignmentMode as ne,Transition as k,Easings as X,TransitionDirection as L,Label as _,Action as n,RandomDraws as K,Shape as B,Timer as d}from"@m2c2kit/core";import{LocalePicker as ie,Instructions as Y,CountdownScene as oe,Grid as G,Button as J}from"@m2c2kit/addons";class re extends ee{constructor(){const e={number_of_dots:{type:"integer",default:3,description:"Number of dots to present."},preparation_duration_ms:{type:"number",default:500,description:"How long the 'get ready' message before each trial is shown, milliseconds."},blank_grid_duration_ms:{type:"number",default:500,description:"How long a blank grid is shown before the dots appear, milliseconds."},interference_duration_ms:{type:"number",default:8e3,description:"How long the grid of interference targets is shown, milliseconds."},interference_transition_animation:{type:"boolean",default:!0,description:"Should the transitions between dot presentation, interference, and recall be animated slide transitions?"},dot_present_duration_ms:{type:"number",default:3e3,description:"How long the dots are shown, milliseconds."},number_of_interference_targets:{type:"integer",default:5,description:"How many targets to show in the interference phase."},number_of_trials:{type:"integer",default:4,description:"How many trials to run."},show_trials_complete_scene:{default:!0,type:"boolean",description:"After the final trial, should a completion scene be shown? Otherwise, the game will immediately end."},instruction_type:{type:"string",default:"long",description:"Type of instructions to show, 'short' or 'long'."},instructions:{default:null,type:["object","null"],description:"When non-null, an InstructionsOptions object that will completely override the built-in instructions."},show_quit_button:{type:"boolean",default:!1,description:"Should the activity quit button be shown?"},show_fps:{type:"boolean",default:!1,description:"Should the FPS be shown?"},show_locale_picker:{type:"boolean",default:!1,description:"Should the icon that allows the participant to switch the locale be shown?"}},T={activity_begin_iso8601_timestamp:{type:"string",format:"date-time",description:"ISO 8601 timestamp at the beginning of the game activity."},trial_begin_iso8601_timestamp:{type:["string","null"],format:"date-time",description:"ISO 8601 timestamp at the beginning of the trial. Null if trial was skipped."},trial_end_iso8601_timestamp:{type:["string","null"],format:"date-time",description:"ISO 8601 timestamp at the end of the trial (when user presses 'Done' after placing the three objects). Null if trial was skipped."},trial_index:{type:["integer","null"],description:"Index of the trial within this assessment, 0-based."},response_time_duration_ms:{type:["number","null"],description:"Milliseconds from the when the empty grid is shown in the recall phase until the user has placed all dots and taps the done button. Null if trial was skipped."},presented_cells:{type:["array","null"],description:"Randomly chosen locations of the dots presented to the user. Null if trial was skipped.",items:{type:"object",properties:{row:{type:"integer",description:"Row of the cell, 0-indexed."},column:{type:"integer",description:"Column of the cell, 0-indexed."}}}},selected_cells:{type:["array","null"],description:"User selected locations of the dots. Null if trial was skipped.",items:{type:"object",properties:{row:{type:"integer",description:"Row of the cell, 0-indexed."},column:{type:"integer",description:"Column of the cell, 0-indexed."}}}},user_dot_actions:{type:["array","null"],description:"Complete user dot actions: placement, removal, and done. Null if trial was skipped.",items:{type:"object",properties:{elapsed_duration_ms:{type:"number",description:"Duration, milliseconds, from when dot recall scene fully appeared until this user action."},action_type:{type:"string",enum:["placed","removed","done"],description:"Was the action a dot placement, dot removal, or done button push?"},cell:{type:["object","null"],description:"Cell of user action; null if non-applicable (user action was done button push).",properties:{row:{type:"integer",description:"Row of the cell, 0-indexed."},column:{type:"integer",description:"Column of the cell, 0-indexed."},tap_x:{type:"number",description:"X coordinate of user's tap on the cell, relative to the cell."},tap_y:{type:"number",description:"Y coordinate of user's tap on the cell, relative to the cell."}}}}}},user_interference_actions:{type:["array","null"],description:"User actions tapping the interference targets. Null if trial was skipped.",items:{type:"object",properties:{elapsed_duration_ms:{type:"number",description:"Duration, milliseconds, from when interference scene fully appeared until this user action."},action_type:{type:"string",enum:["on-target","off-target"],description:"Was the action on an interference target or off?"},cell:{type:"object",description:"Cell of user interference action.",properties:{row:{type:"integer",description:"Row of the cell, 0-indexed."},column:{type:"integer",description:"Column of the cell, 0-indexed."},tap_x:{type:"number",description:"X coordinate of user's tap on the cell, relative to the cell."},tap_y:{type:"number",description:"Y coordinate of user's tap on the cell, relative to the cell."}}}}}},number_of_correct_dots:{type:["integer","null"],description:"Number of dots that were correctly placed. Null if trial was skipped."},quit_button_pressed:{type:"boolean",description:"Was the quit button pressed?"}},u={configuration:{baseLocale:"en-US"},"en-US":{localeName:"English",INSTRUCTIONS_TITLE:"Grid Memory",INSTRUCTIONS_TEXT_PAGE_1:"For this activity, try to remember the location of {{NUMBER_OF_DOTS}} dots.",INSTRUCTIONS_TEXT_PAGE_2:"Before placing the {{NUMBER_OF_DOTS}} dots in their location, you will also have to tap some Fs on the screen as quickly as you can.",INSTRUCTIONS_TEXT_PAGE_3:"Press START to begin!",GET_READY:"GET READY",REMEMBER_LOCATIONS:"Remember the dot locations!",TOUCH_INTERFERENCE:"Touch the F's!",DONE_BUTTON_TEXT:"Done",WHERE_WERE:"Where were the dots?",MUST_SELECT:"You must select all {{NUMBER_OF_DOTS}} locations!",START_BUTTON_TEXT:"START",NEXT_BUTTON_TEXT:"Next",BACK_BUTTON_TEXT:"Back",TRIALS_COMPLETE_SCENE_TEXT:"This activity is complete.",TRIALS_COMPLETE_SCENE_BUTTON_TEXT:"OK"},"es-MX":{localeName:"Espa\xF1ol",INSTRUCTIONS_TITLE:"Memoria de Puntos",INSTRUCTIONS_TEXT_PAGE_1:"Para esta actividad, intenta recordar la ubicaci\xF3n de {{NUMBER_OF_DOTS}} puntos.",INSTRUCTIONS_TEXT_PAGE_2:"Antes de colocar los {{NUMBER_OF_DOTS}} puntos en su ubicaci\xF3n, tambi\xE9n tendr\xE1s que tocar las Fs en la pantalla lo m\xE1s r\xE1pido que puedas.",INSTRUCTIONS_TEXT_PAGE_3:"Presione COMENZAR para Empezar",GET_READY:"PREP\xC1RESE",REMEMBER_LOCATIONS:"Recuerda las ubicaciones de los puntos",TOUCH_INTERFERENCE:"\xA1Toca las Fs!",DONE_BUTTON_TEXT:"Listo",WHERE_WERE:"\xBFD\xF3nde estaban los puntos?",MUST_SELECT:"\xA1Debes seleccionar todas las {{NUMBER_OF_DOTS}} ubicaciones!",START_BUTTON_TEXT:"COMENZAR",NEXT_BUTTON_TEXT:"Siguiente",BACK_BUTTON_TEXT:"Atr\xE1s",TRIALS_COMPLETE_SCENE_TEXT:"Esta actividad est\xE1 completa.",TRIALS_COMPLETE_SCENE_BUTTON_TEXT:"OK"},"de-DE":{localeName:"Deutsch",INSTRUCTIONS_TITLE:"Raster-Ged\xE4chtnis",INSTRUCTIONS_TEXT_PAGE_1:"In dieser Aufgabe werden {{NUMBER_OF_DOTS}} rote Punkte kurz in einem Raster erscheinen. Ihre Aufgabe ist es, sich ihre Standorte zu merken!",INSTRUCTIONS_TEXT_PAGE_2:"Als n\xE4chstes werden Sie eine Seite voll mit den Buchstaben E und F sehen, wie auf dem Beispiel unten. Ihre Aufgabe ist es, so schnell wie m\xF6glich auf alle F's zu tippen!",INSTRUCTIONS_TEXT_PAGE_3:"Sobald das leere Raster erscheint, platzieren Sie die Punkte dort, wo Sie sie zuvor gesehen haben, indem Sie auf die entsprechenden Stellen tippen.",GET_READY:"BEREIT MACHEN",REMEMBER_LOCATIONS:"Merken Sie sich die Punktpositionen!",TOUCH_INTERFERENCE:"Ber\xFChren die F's!",DONE_BUTTON_TEXT:"Fertig",WHERE_WERE:"Wo waren die Punkte?",MUST_SELECT:"Sie m\xFCssen alle {{NUMBER_OF_DOTS}} Punktpositionen ausw\xE4hlen!",START_BUTTON_TEXT:"START",NEXT_BUTTON_TEXT:"Weiter",BACK_BUTTON_TEXT:"Vorherige",TRIALS_COMPLETE_SCENE_TEXT:"Die Aufgabe ist beendet.",TRIALS_COMPLETE_SCENE_BUTTON_TEXT:"OK"}},c=200,S={name:"Grid Memory",id:"grid-memory",publishUuid:"50ee0af4-d013-408f-a7d1-c8d5c04da920",version:"0.8.27 (d1ad307f)",moduleMetadata:{name:"@m2c2kit/assessment-grid-memory",version:"0.8.27",dependencies:{"@m2c2kit/addons":"0.3.28","@m2c2kit/core":"0.3.29"}},translation:u,shortDescription:"Grid Memory is a visuospatial working memory task, with delayed free recall. After a brief exposure, and a short distraction phase, participants report the location of dots on a grid.",longDescription:'Each trial of the dot memory task consisted of 3 phases: encoding,   distraction, and retrieval. During the encoding phase, the participant was   asked to remember the location three red dots appear on a 5 x 5 grid. After   a 3-second study period, the grid was removed and the distraction phase   began, during which the participant was required to locate and touch Fs among   an array of Es. After performing the distraction task for 8 seconds, and   empty 5 x 5 grid reappeared on the screen and participants were then   prompted to recall the locations of the 3 dots presented initially and press   a button labeled "Done" after entering their responses to complete the trial.   Participants completed 2 trials (encoding, distractor, retrieval) with a   1-second delay between trials. The dependent variable was an error score with   partial credit given based on the deviation from the correct positions. If   all dots were recalled in their correct location, the participant received a   score of zero. In the case of one or more retrieval errors, Euclidean distance   of the location of the incorrect dot to the correct grid location was   calculated, with higher scores indicating less accurate placement and poorer   performance (Siedlecki, 2007). The rationale for our use of this task as an   indicator of working memory has both an empirical and theoretical basis.   Previous research (Miyake, Friedman, Rettinger, Shah, & Hegarty, 2001) has   demonstrated that a similar dotmemory task loaded on a factor representing   working memory. The authors of this study reasoned that the spatial dot   memory task placed high demands on controlled attention\u2014a hallmark of working   memory tasks. Indeed, individual differences in working memory capacity arise   "in situations where information needs to be actively maintained or when a   controlled search of memory is required" (Unsworth & Engle, 2007, p. 123).   The ambulatory dot memory task satisfies this requirement by using an   interference task to prevent rehearsal and produce interference with encoded   locations, which creates the demand for active maintenance and controlled   retrieval of previously encoded location during the recall phase.   SOURCE: Sliwinski, Martin J., Jacqueline A. Mogle, Jinshil Hyun, Elizabeth   Munoz, Joshua M. Smyth, and Richard B. Lipton. "Reliability and validity of   ambulatory cognitive assessments." Assessment 25, no. 1 (2018): 14-30.',showFps:e.show_fps.default,width:400,height:800,trialSchema:T,parameters:e,fonts:[{fontName:"roboto",url:"fonts/roboto/Roboto-Regular.ttf"}],images:[{imageName:"grid",height:c,width:c,url:"images/dotmem1_grid.png"},{imageName:"fs",height:c,width:c,url:"images/dotmem2_fs.png"},{imageName:"circle-x",height:32,width:32,url:"images/circle-x.svg"}]};super(S)}async initialize(){await super.initialize();const e=this;let T,u,c,S;const h=e.getParameter("number_of_dots");if(e.getParameter("show_quit_button")){const t=new te({imageName:"circle-x",position:{x:380,y:20},isUserInteractionEnabled:!0});e.addFreeNode(t),t.onTapDown(r=>{e.removeAllFreeNodes(),r.handled=!0;const i=new N;e.addScene(i),e.presentScene(i),e.addTrialData("quit_button_pressed",!0),e.trialComplete(),e.cancel()})}let z;e.getParameter("show_locale_picker")&&(z=new ie,e.addFreeNode(z));let I;const q=e.getParameter("instructions");if(q)I=Y.create(q);else{if(!this.i18n)throw new Error("No i18n object found.");I=Y.create({instructionScenes:[{title:"INSTRUCTIONS_TITLE",text:"INSTRUCTIONS_TEXT_PAGE_1",textInterpolation:{NUMBER_OF_DOTS:h.toString()},imageName:"grid",imageAboveText:!1,imageMarginTop:12,textFontSize:24,titleFontSize:30,textVerticalBias:.25,nextButtonText:"NEXT_BUTTON_TEXT",backButtonText:"BACK_BUTTON_TEXT"},{title:"INSTRUCTIONS_TITLE",text:"INSTRUCTIONS_TEXT_PAGE_2",textInterpolation:{NUMBER_OF_DOTS:h.toString()},imageName:"fs",imageAboveText:!1,imageMarginTop:12,textFontSize:24,titleFontSize:30,textVerticalBias:.25,nextButtonText:"NEXT_BUTTON_TEXT",backButtonText:"BACK_BUTTON_TEXT"},{title:"INSTRUCTIONS_TITLE",text:"INSTRUCTIONS_TEXT_PAGE_3",textFontSize:24,titleFontSize:30,textAlignmentMode:ne.Center,nextButtonText:"START_BUTTON_TEXT",nextButtonBackgroundColor:l.Green,backButtonText:"BACK_BUTTON_TEXT"}]})}I[0].onAppear(()=>{e.addTrialData("activity_begin_iso8601_timestamp",this.beginIso8601Timestamp)}),e.addScenes(I);let W,H;e.getParameter("interference_transition_animation")&&(W=k.slide({direction:L.Left,duration:500,easing:X.sinusoidalInOut}),H=k.slide({direction:L.Right,duration:500,easing:X.sinusoidalInOut}));const V=new oe({milliseconds:3e3,text:"",zeroDwellMilliseconds:1e3,transition:k.none()});e.addScene(V);const C=new N;e.addScene(C);const Z=new _({text:"GET_READY",fontSize:24,position:{x:200,y:400}});C.addChild(Z),C.onAppear(()=>{C.run(n.sequence([n.custom({callback:()=>{e.addTrialData("activity_begin_iso8601_timestamp",this.beginIso8601Timestamp),e.addTrialData("trial_begin_iso8601_timestamp",new Date().toISOString())}}),n.wait({duration:e.getParameter("preparation_duration_ms")}),n.custom({callback:()=>{e.presentScene(f)}})]))});const f=new N;e.addScene(f);const A=new _({text:"REMEMBER_LOCATIONS",fontSize:24,position:{x:200,y:150}});f.addChild(A);const M=new G({size:{width:300,height:300},position:{x:200,y:400},rows:5,columns:5,backgroundColor:l.Silver,gridLineColor:l.Black,gridLineWidth:4});f.addChild(M),f.onSetup(()=>{A.hidden=!0}),f.onAppear(()=>{A.hidden=!1,f.run(n.sequence([n.wait({duration:e.getParameter("blank_grid_duration_ms")}),n.custom({callback:()=>{T=K.FromGridWithoutReplacement(h,5,5);for(let t=0;t<h;t++){const r=new B({circleOfRadius:20,fillColor:l.Red,strokeColor:l.Black,lineWidth:2});M.addAtCell(r,T[t].row,T[t].column)}}}),n.wait({duration:e.getParameter("dot_present_duration_ms")}),n.custom({callback:()=>{M.removeAllGridChildren(),A.hidden=!0,e.presentScene(E,W)}})]))});const E=new N;e.addScene(E);const v=new _({text:"TOUCH_INTERFERENCE",fontSize:24,position:{x:200,y:100}});E.addChild(v);const g=new G({size:{width:300,height:480},position:{x:200,y:400},rows:8,columns:5,backgroundColor:l.Transparent,gridLineColor:l.Transparent});E.addChild(g),E.onSetup(()=>{S=new Array,d.startNew("interferenceResponseTime"),v.hidden=!0,t(),E.run(n.sequence([n.wait({duration:e.getParameter("interference_duration_ms")}),n.custom({callback:()=>{d.remove("interferenceResponseTime"),e.presentScene(m,H)}})]),"advanceAfterInterference");function t(r=!1){g.removeAllGridChildren();let i=0;const o=e.getParameter("number_of_interference_targets"),a=K.FromGridWithoutReplacement(o,8,5);for(let y=0;y<8;y++)for(let b=0;b<5;b++){const s=new B({rect:{size:{width:59,height:59}},fillColor:l.Transparent});let j=!1,x;x=new _({text:"E",fontSize:50});for(let p=0;p<o;p++)a[p].row===y&&a[p].column===b&&(x=new _({text:"F",fontSize:50}),j=!0);s.userData={},s.userData.row=y,s.userData.column=b,j?s.userData.tapStatus=0:s.userData.tapStatus=-1,s.isUserInteractionEnabled=!0,s.onTapDown(p=>{s.userData.tapStatus===0?(i++,x.text="E",x.run(n.sequence([n.scale({scale:1.25,duration:125}),n.scale({scale:1,duration:125})])),s.userData.tapStatus=1,i>=o&&(g.gridChildren.forEach($=>{$.node.isUserInteractionEnabled=!1}),t(!0)),d.exists("interferenceResponseTime")&&S.push({elapsed_duration_ms:d.elapsed("interferenceResponseTime"),action_type:"on-target",cell:{row:s.userData.row,column:s.userData.column,tap_x:p.point.x,tap_y:p.point.y}})):d.exists("interferenceResponseTime")&&S.push({elapsed_duration_ms:d.elapsed("interferenceResponseTime"),action_type:"off-target",cell:{row:s.userData.row,column:s.userData.column,tap_x:p.point.x,tap_y:p.point.y}})}),g.addAtCell(x,y,b),g.addAtCell(s,y,b)}r&&(g.position={x:200,y:1040},g.run(n.move({point:{x:200,y:400},duration:500})))}}),E.onAppear(()=>{v.hidden=!1});const m=new N;e.addScene(m);const F=new _({text:"WHERE_WERE",fontSize:24,position:{x:200,y:150}});m.addChild(F);const P=new G({size:{width:300,height:300},position:{x:200,y:400},rows:5,columns:5,backgroundColor:l.Silver,gridLineColor:l.Black,gridLineWidth:4});m.addChild(P);let R=0;m.onSetup(()=>{d.startNew("responseTime"),P.removeAllGridChildren(),O.hidden=!0,F.hidden=!0,R=0,u=new Array,c=new Array;for(let t=0;t<5;t++)for(let r=0;r<5;r++){const i=new B({rect:{size:{width:59,height:59}},fillColor:l.Transparent});i.userData=0,i.onTapDown(o=>{if(i.userData===0&&R<h){const a=new B({circleOfRadius:20,fillColor:l.Red,strokeColor:l.Black,lineWidth:2});i.addChild(a),i.userData=1,R++,u.push({row:t,column:r}),c.push({elapsed_duration_ms:d.elapsed("responseTime"),action_type:"placed",cell:{row:t,column:r,tap_x:o.point.x,tap_y:o.point.y}})}else i.userData===1&&(i.removeAllChildren(),i.userData=0,R--,u=u.filter(a=>!(a.row===t&&a.column===r)),c.push({elapsed_duration_ms:d.elapsed("responseTime"),action_type:"removed",cell:{row:t,column:r,tap_x:o.point.x,tap_y:o.point.y}}))}),i.isUserInteractionEnabled=!0,P.addAtCell(i,t,r)}}),m.onAppear(()=>{O.hidden=!1,F.hidden=!1});const O=new J({text:"DONE_BUTTON_TEXT",position:{x:200,y:700},size:{width:250,height:50}});m.addChild(O);const D=new _({text:"MUST_SELECT",interpolation:{NUMBER_OF_DOTS:h.toString()},position:{x:200,y:600},hidden:!0});m.addChild(D),O.isUserInteractionEnabled=!0,O.onTapDown(()=>{const t=d.elapsed("responseTime");if(c.push({elapsed_duration_ms:t,action_type:"done",cell:null}),R<h)D.run(n.sequence([n.custom({callback:()=>{D.hidden=!1}}),n.wait({duration:3e3}),n.custom({callback:()=>{D.hidden=!0}})]));else{d.stop("responseTime"),d.remove("responseTime"),e.addTrialData("trial_end_iso8601_timestamp",new Date().toISOString()),e.addTrialData("response_time_duration_ms",t),e.addTrialData("presented_cells",T),e.addTrialData("selected_cells",u),e.addTrialData("user_dot_actions",c),e.addTrialData("user_interference_actions",S);const r=(o,a)=>o.row===a.row&&o.column===a.column,i=u.map(o=>T.some(a=>r(a,o))?1:0).reduce((o,a)=>o+a,0);if(e.addTrialData("number_of_correct_dots",i),e.addTrialData("quit_button_pressed",!1),e.addTrialData("trial_index",e.trialIndex),e.trialComplete(),e.trialIndex===e.getParameter("number_of_trials")){const o=k.slide({direction:L.Left,duration:500,easing:X.sinusoidalInOut});e.getParameter("show_trials_complete_scene")?e.presentScene(w,o):e.end()}else e.presentScene(C)}});const w=new N;e.addScene(w);const Q=new _({text:"TRIALS_COMPLETE_SCENE_TEXT",position:{x:200,y:400}});w.addChild(Q);const U=new J({text:"TRIALS_COMPLETE_SCENE_BUTTON_TEXT",position:{x:200,y:600}});U.isUserInteractionEnabled=!0,U.onTapDown(()=>{U.isUserInteractionEnabled=!1,w.removeAllChildren(),e.end()}),w.addChild(U),w.onSetup(()=>{e.removeAllFreeNodes()})}}export{re as GridMemory};
