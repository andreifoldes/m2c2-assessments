import{Game as ce,WebColors as a,Sprite as pe,Scene as y,M2Error as G,Transition as ee,RandomDraws as I,Shape as m,Label as D,Action as u,Timer as f,LabelHorizontalAlignmentMode as ue,Equal as z,Easings as Te,TransitionDirection as _e}from"@m2c2kit/core";import{LocalePicker as he,Instructions as H,CountdownScene as me,Grid as fe,Button as j}from"@m2c2kit/addons";class ge extends ce{constructor(){const e={fixation_duration_ms:{default:500,description:"How long fixation scene is shown, milliseconds.",type:"number"},dot_colors:{type:"array",description:"Array of colors for dots.",items:{type:"object",properties:{colorName:{type:"string",description:"Human-friendly name of color."},rgbaColor:{type:"array",description:"Color as array, [r,g,b,a].",items:{type:"number"}}}},default:[{colorName:"black",rgbaColor:[0,0,0,1]},{colorName:"green",rgbaColor:[0,158,115,1]},{colorName:"yellow",rgbaColor:[240,228,66,1]},{colorName:"blue",rgbaColor:[0,114,178,1]},{colorName:"orange",rgbaColor:[213,94,0,1]},{colorName:"pink",rgbaColor:[204,121,167,1]}]},dot_diameter:{default:48,description:"Diameter of dots.",type:"number"},number_of_dots:{default:3,description:"How many dots to present. Must be at least 3.",type:"integer"},dot_present_duration_ms:{default:1e3,description:"How long the dots are shown, milliseconds.",type:"number"},dot_blank_duration_ms:{default:750,description:"How long to show a blank square after dots are removed, milliseconds.",type:"number"},color_selected_hold_duration_ms:{default:500,description:"How long to show a square with the dot colored by the user's choice, before advancing to next scene, milliseconds.",type:"number"},number_of_trials:{default:5,description:"How many trials to run.",type:"integer"},show_trials_complete_scene:{default:!0,type:"boolean",description:"After the final trial, should a completion scene be shown? Otherwise, the game will immediately end."},instruction_type:{default:"long",description:"Type of instructions to show, 'short' or 'long'.",type:"string",enum:["short","long"]},instructions:{default:null,type:["object","null"],description:"When non-null, an InstructionsOptions object that will completely override the built-in instructions."},show_quit_button:{type:"boolean",default:!1,description:"Should the activity quit button be shown?"},show_fps:{type:"boolean",default:!1,description:"Should the FPS be shown?"},show_locale_picker:{type:"boolean",default:!1,description:"Should the icon that allows the participant to switch the locale be shown?"}},r={activity_begin_iso8601_timestamp:{type:"string",format:"date-time",description:"ISO 8601 timestamp at the beginning of the game activity."},trial_begin_iso8601_timestamp:{type:["string","null"],format:"date-time",description:"ISO 8601 timestamp at the beginning of the trial. Null if trial was skipped."},trial_end_iso8601_timestamp:{type:["string","null"],format:"date-time",description:"ISO 8601 timestamp at the end of the trial (when user presses 'Done' after placing the dot). Null if trial was skipped."},trial_index:{type:["integer","null"],description:"Index of the trial within this assessment, 0-based."},square_side_length:{type:["number","null"],description:"Length of square side, in pixels. This is the square in which the dots are shown. Null if trial was skipped."},presented_dots:{description:"Configuration of dots presented to the user. Null if trial was skipped.",type:["array","null"],items:{type:"object",properties:{color_name:{type:"string",description:"Human-friendly name of color."},rgba_color:{type:"array",description:"Color as array, [r,g,b,a].",items:{type:"number"}},location:{type:"object",description:"Location of dot.",properties:{x:{type:"number",description:"X coordinate of dot."},y:{type:"number",description:"Y coordinate of dot."}}}}}},color_target_dot_index:{description:"Index (0-based) of presented dot whose color the user was asked to recall. Null if trial was skipped.",type:["integer","null"]},color_selected:{description:"Color selected by user. Null if trial was skipped.",type:["object","null"],properties:{color_name:{type:"string",description:"Human-friendly name of color."},rgba_color:{type:"array",description:"Color as array, [r,g,b,a].",items:{type:"number"}}}},color_selected_correct:{type:["boolean","null"],description:"Was the color selected by the user correct? Null if trial was skipped."},location_target_dot_index:{description:"Index (0-based) of presented dot whose location the user was asked to recall. Null if trial was skipped.",type:["integer","null"]},location_selected:{description:"Location selected by user. Null if trial was skipped.",type:["object","null"],properties:{x:{type:"number",description:"X coordinate of dot."},y:{type:"number",description:"Y coordinate of dot."}}},location_selected_delta:{type:["number","null"],description:"Euclidean distance between location target dot and the location selected by user. Null if trial was skipped."},color_selection_response_time_ms:{type:["number","null"],description:"Milliseconds from the beginning of color selection task until the user taps the done button. Null if trial was skipped."},location_selection_response_time_ms:{type:["number","null"],description:"Milliseconds from the beginning of location selection task until the user taps the done button. Null if trial was skipped."},quit_button_pressed:{type:"boolean",description:"Was the quit button pressed?"}},R={name:"Color Dots",id:"color-dots",publishUuid:"72a1ef60-75c0-47b3-921c-aaee72cca9da",version:"0.8.30 (f8bdff76)",moduleMetadata:{name:"@m2c2kit/assessment-color-dots",version:"0.8.30",dependencies:{"@m2c2kit/addons":"0.3.31","@m2c2kit/core":"0.3.32"}},translation:{configuration:{baseLocale:"en-US"},"en-US":{localeName:"English",INSTRUCTIONS_TITLE:"Color Dots",SHORT_INSTRUCTIONS_TEXT_PAGE_1:"For this activity, try to remember the location and color of 3 dots.",INSTRUCTIONS_TEXT_PAGE_1:"For this activity, try to remember the location and color of 3 dots.",INSTRUCTIONS_TEXT_PAGE_2:"Choose the color of the dot from the options at the bottom of the screen.",INSTRUCTIONS_TEXT_PAGE_3:"Next you are asked to place another dot. Touch the screen where you remember seeing the dot.",WHAT_COLOR:"What color was this dot?",WHERE_WAS:"Where was this dot?",TOUCH_TO_MOVE:"Touch the screen to move the dot",DONE_BUTTON_TEXT:"Done",START_BUTTON_TEXT:"START",NEXT_BUTTON_TEXT:"Next",BACK_BUTTON_TEXT:"Back",GET_READY_COUNTDOWN_TEXT:"GET READY!",TRIALS_COMPLETE_SCENE_TEXT:"This activity is complete.",TRIALS_COMPLETE_SCENE_BUTTON_TEXT:"OK"},"es-MX":{localeName:"Espa\xF1ol",INSTRUCTIONS_TITLE:"Puntos de Color",SHORT_INSTRUCTIONS_TEXT_PAGE_1:"Para esta actividad, intenta recordar la ubicaci\xF3n y el color de 3 puntos.",INSTRUCTIONS_TEXT_PAGE_1:"Para esta actividad, intenta recordar la ubicaci\xF3n y el color de 3 puntos.",INSTRUCTIONS_TEXT_PAGE_2:"Escoja el color del punto de las opciones en la parte de abajo de la pantalla.",INSTRUCTIONS_TEXT_PAGE_3:"Luego, se te pedir\xE1 que coloques otro punto. Toca la pantalla donde recuerdas haber visto el punto.",WHAT_COLOR:"\xBFDe qu\xE9 color era este punto?",WHERE_WAS:"\xBFD\xF3nde estaba este punto?",TOUCH_TO_MOVE:"Toca la pantalla para mover el punto",DONE_BUTTON_TEXT:"Listo",START_BUTTON_TEXT:"COMENZAR",NEXT_BUTTON_TEXT:"Siguiente",BACK_BUTTON_TEXT:"Atr\xE1s",GET_READY_COUNTDOWN_TEXT:"PREP\xC1RESE",TRIALS_COMPLETE_SCENE_TEXT:"Esta actividad est\xE1 completa.",TRIALS_COMPLETE_SCENE_BUTTON_TEXT:"OK"}},shortDescription:"Color Dots is cued-recall, item-location memory binding task, where after viewing 3 dots for a brief period of time, participants report: (1) the color at a cued location; (2) the location of a cued color.",longDescription:"Participants are asked to remember the location and color of three briefly presented, and uniquely colored dots. Each trial of this task requires two responses (subsequently referred to as stage 1 and stage 2 in the list of outcome variables): (1) reporting the color at a cued location; (2) reporting the location where a circular of a specified color previously appeared.",showFps:e.show_fps.default,width:400,height:800,bodyBackgroundColor:a.White,trialSchema:r,parameters:e,fonts:[{fontName:"roboto",url:"fonts/roboto/Roboto-Regular.ttf"}],images:[{imageName:"cd1",height:450,width:350,url:"images/cd1.png"},{imageName:"cd2",height:450,width:350,url:"images/cd2.png",localize:!0},{imageName:"cd3",height:450,width:350,url:"images/cd3.png",localize:!0},{imageName:"circle-x",height:32,width:32,url:"images/circle-x.svg"}]};super(R)}async initialize(){await super.initialize();const e=this,r=350;if(e.getParameter("show_quit_button")){const t=new pe({imageName:"circle-x",position:{x:380,y:20},isUserInteractionEnabled:!0});e.addFreeNode(t),t.onTapDown(o=>{e.removeAllFreeNodes(),o.handled=!0;const n=new y;e.addScene(n),e.presentScene(n),e.addTrialData("quit_button_pressed",!0),e.trialComplete(),e.cancel()})}let B;e.getParameter("show_locale_picker")&&(B=new he,e.addFreeNode(B));let R,T,w;const K=e.getParameter("instructions");if(K)w=H.create(K);else switch(e.getParameter("instruction_type")){case"short":{w=H.create({instructionScenes:[{title:"INSTRUCTIONS_TITLE",text:"SHORT_INSTRUCTIONS_TEXT_PAGE_1",imageName:"cd1",imageAboveText:!1,textFontSize:24,titleFontSize:30,textVerticalBias:.2,nextButtonText:"START_BUTTON_TEXT",nextButtonBackgroundColor:a.Green}]});break}case"long":{w=H.create({instructionScenes:[{title:"INSTRUCTIONS_TITLE",text:"INSTRUCTIONS_TEXT_PAGE_1",imageName:"cd1",imageAboveText:!1,textFontSize:24,titleFontSize:30,textVerticalBias:.2,nextButtonText:"NEXT_BUTTON_TEXT",backButtonText:"BACK_BUTTON_TEXT"},{title:"INSTRUCTIONS_TITLE",text:"INSTRUCTIONS_TEXT_PAGE_2",imageName:"cd2",imageAboveText:!1,textFontSize:24,titleFontSize:30,textVerticalBias:.15,nextButtonText:"NEXT_BUTTON_TEXT",backButtonText:"BACK_BUTTON_TEXT"},{title:"INSTRUCTIONS_TITLE",text:"INSTRUCTIONS_TEXT_PAGE_3",imageName:"cd3",imageAboveText:!1,imageMarginTop:8,textFontSize:24,titleFontSize:30,textVerticalBias:.15,nextButtonText:"START_BUTTON_TEXT",nextButtonBackgroundColor:a.Green,backButtonText:"BACK_BUTTON_TEXT"}]});break}default:throw new G("invalid value for instruction_type")}w[0].onAppear(()=>{e.addTrialData("activity_begin_iso8601_timestamp",this.beginIso8601Timestamp)}),e.addScenes(w);const te=new me({milliseconds:3e3,text:"GET_READY_COUNTDOWN_TEXT",zeroDwellMilliseconds:1e3,transition:ee.none()});e.addScene(te);const x=[],V=e.getParameter("number_of_dots"),A=e.getParameter("dot_colors"),l=e.getParameter("dot_diameter"),Y=A.length;function oe(t,o,n){for(let i=0;i<n.length;i++)if(Math.sqrt(Math.pow(t-n[i].x,2)+Math.pow(o-n[i].y,2))<l*3+.25*l)return!0;return!1}for(let t=0;t<e.getParameter("number_of_trials");t++){const o=JSON.parse(JSON.stringify(A)),n=new Array;for(let s=0;s<V;s++){let c,O;do c=I.SingleFromRange(0+l/2+4,r-l/2-4),O=I.SingleFromRange(0+l/2+4,r-l/2-4);while(oe(c,O,n));const se=I.SingleFromRange(0,o.length-1),$=o.splice(se,1)[0],de={x:c,y:O,rgbaColor:$.rgbaColor,colorName:$.colorName};n.push(de)}const i=I.SingleFromRange(0,n.length-1);x.push({colorSelectionDotIndex:i,locationSelectionDotIndex:NaN,dots:n})}const g=new y;e.addScene(g);const J=new m({rect:{size:{width:r,height:r}},fillColor:a.Transparent,strokeColor:a.Gray,lineWidth:4,position:{x:200,y:300}});g.addChild(J);const ie=new D({text:"+",fontSize:32,fontColor:a.Black,localize:!1});J.addChild(ie),g.onSetup(()=>{g.run(u.sequence([u.wait({duration:e.getParameter("fixation_duration_ms")}),u.custom({callback:()=>{e.presentScene(E)}})]))}),g.onAppear(()=>{e.addTrialData("activity_begin_iso8601_timestamp",this.beginIso8601Timestamp),e.addTrialData("trial_begin_iso8601_timestamp",new Date().toISOString())});const E=new y;e.addScene(E);const P=new m({rect:{size:{width:r,height:r}},fillColor:a.Transparent,strokeColor:a.Gray,lineWidth:4,position:{x:200,y:300}});E.addChild(P);const X=new Array;E.onSetup(()=>{X.length=0;const t=x[e.trialIndex];for(const o of t.dots){const n={x:o.x,y:o.y,rgbaColor:o.rgbaColor,colorName:o.colorName,shape:new m({circleOfRadius:l/2,fillColor:o.rgbaColor,position:{x:o.x-r/2,y:o.y-r/2}})};X.push(n),P.addChild(n.shape)}E.run(u.sequence([u.wait({duration:e.getParameter("dot_present_duration_ms")}),u.custom({callback:()=>{P.removeAllChildren()}}),u.wait({duration:e.getParameter("dot_blank_duration_ms")}),u.custom({callback:()=>{e.presentScene(_)}})]))});const _=new y;e.addScene(_);const L=new m({rect:{size:{width:r,height:r}},fillColor:a.Transparent,strokeColor:a.Gray,lineWidth:4,position:{x:200,y:300}});_.addChild(L);const v=new D({text:"WHAT_COLOR",fontSize:24,position:{x:200,y:75}});_.addChild(v);const q=new m({position:{x:200,y:530},fillColor:a.Transparent,strokeColor:a.Black,lineWidth:2,rect:{width:350,height:60}});_.addChild(q);const N=new fe({position:{x:200,y:530},rows:1,columns:Y,size:{width:350,height:60},backgroundColor:a.Transparent,gridLineColor:a.Transparent});_.addChild(N);let Q=-1;const S=new j({position:{x:200,y:650},text:"DONE_BUTTON_TEXT",hidden:!0});S.onTapDown(()=>{f.stop("colorRt"),Q=f.elapsed("colorRt"),f.remove("colorRt"),e.addTrialData("color_selection_response_time_ms",Q),v.hidden=!0,q.hidden=!0,N.hidden=!0,S.hidden=!0,S.run(u.sequence([u.wait({duration:e.getParameter("color_selected_hold_duration_ms")}),u.custom({callback:()=>{if(!T)throw new G("no selected color");R={color_name:A.filter(i=>z.rgbaColor(i.rgbaColor,T))[0].colorName,rgba_color:T},e.addTrialData("color_selected",R);const o=x[e.trialIndex],n=o.dots[o.colorSelectionDotIndex];e.addTrialData("color_selected_correct",z.rgbaColor(n.rgbaColor,T)),e.presentScene(p)}})]))}),_.addChild(S),_.onSetup(()=>{v.hidden=!1,q.hidden=!1,N.hidden=!1,L.removeAllChildren();const o=x[e.trialIndex].colorSelectionDotIndex,n=X[o].shape.duplicate();n.fillColor=a.Transparent,n.strokeColor=a.Black,n.lineWidth=2,L.addChild(n),N.removeAllGridChildren();for(let i=0;i<Y;i++){const s=new m({circleOfRadius:l/2,fillColor:A[i].rgbaColor,isUserInteractionEnabled:!0});s.size={width:l,height:l},s.onTapDown(()=>{n.fillColor=s.fillColor,S.hidden=!1,S.isUserInteractionEnabled=!0,T=s.fillColor}),N.addAtCell(s,0,i)}}),_.onAppear(()=>{f.startNew("colorRt")});const p=new y({isUserInteractionEnabled:!0});e.addScene(p);const b=new m({rect:{size:{width:r,height:r}},fillColor:a.Transparent,strokeColor:a.Gray,lineWidth:4,position:{x:200,y:300}});p.addChild(b),b.onPointerDown(()=>{k=!1});const ne=new D({text:"WHERE_WAS",fontSize:24,position:{x:165,y:75},preferredMaxLayoutWidth:285,horizontalAlignmentMode:ue.Left});p.addChild(ne);const re=new D({text:"TOUCH_TO_MOVE",fontSize:24,position:{x:200,y:530}});p.addChild(re);let d,W;function F(t){const o=M(t);return!(o.x<l/2||o.x+l/2>r||o.y<l/2||o.y+l/2>r)}function ae(t){const o=M(t);return!(o.x<0||o.x>r||o.y<0||o.y>r)}function M(t){const o=b.position.x-r/2,n=b.position.y-r/2,i=t.x-o,s=t.y-n;return{x:i,y:s}}let k=!1;p.onPointerUp(t=>{k||ae(t.point)&&(d.position={x:t.point.x,y:t.point.y},F(d.position)?h.hidden=!1:h.hidden=!0)}),p.onSetup(()=>{const t=x[e.trialIndex],o=t.colorSelectionDotIndex;h.hidden=!0,b.removeAllChildren();const n=new m({circleOfRadius:l/2,fillColor:T,strokeColor:a.Black,lineWidth:2,position:{x:t.dots[o].x-r/2,y:t.dots[o].y-r/2}});b.addChild(n);let i=-1;do i=I.SingleFromRange(0,V-1),z.rgbaColor(t.dots[i].rgbaColor,T)&&(i=-1),i===o&&(i=-1);while(i===-1);t.locationSelectionDotIndex=i,d=new m({circleOfRadius:l/2,fillColor:t.dots[i].rgbaColor,position:{x:345,y:75},isUserInteractionEnabled:!0,draggable:!0}),p.addChild(d),W={x:t.dots[i].x,y:t.dots[i].y,color_name:t.dots[i].colorName,color_rgba:t.dots[i].rgbaColor};const s=[];for(let c=0;c<t.dots.length;c++){const O={color_name:t.dots[c].colorName,rgba_color:t.dots[c].rgbaColor,location:{x:t.dots[c].x,y:t.dots[c].y}};s.push(O)}if(e.addTrialData("presented_dots",s),e.addTrialData("color_target_dot_index",t.colorSelectionDotIndex),e.addTrialData("location_target_dot_index",t.locationSelectionDotIndex),!T)throw new G("no selected color!");n.fillColor=T,d.onTapDown(c=>{c.handled=!0}),d.onDragStart(()=>{k=!0}),d.onDrag(()=>{F(d.position)?h.hidden=!1:h.hidden=!0}),d.onDragEnd(()=>{k=!1,F(d.position)?h.hidden=!1:h.hidden=!0})}),p.onAppear(()=>{f.startNew("locationRt")});let Z=-1;const h=new j({position:{x:200,y:650},text:"DONE_BUTTON_TEXT",hidden:!0,isUserInteractionEnabled:!0});h.onTapDown(()=>{f.stop("locationRt"),Z=f.elapsed("locationRt"),f.remove("locationRt"),e.addTrialData("location_selection_response_time_ms",Z),e.addTrialData("trial_end_iso8601_timestamp",new Date().toISOString()),p.removeChild(d);const t=M(d.position);e.addTrialData("location_selected",t),e.addTrialData("square_side_length",r);const o=Math.sqrt(Math.pow(t.x-W.x,2)+Math.pow(t.y-W.y,2));e.addTrialData("location_selected_delta",o),e.addTrialData("quit_button_pressed",!1),e.addTrialData("trial_index",e.trialIndex),e.trialComplete(),e.trialIndex<e.getParameter("number_of_trials")?e.presentScene(g):e.getParameter("show_trials_complete_scene")?e.presentScene(C,ee.slide({direction:_e.Left,duration:500,easing:Te.sinusoidalInOut})):e.end()}),p.addChild(h);const C=new y;e.addScene(C);const le=new D({text:"TRIALS_COMPLETE_SCENE_TEXT",position:{x:200,y:400}});C.addChild(le);const U=new j({text:"TRIALS_COMPLETE_SCENE_BUTTON_TEXT",position:{x:200,y:650}});U.isUserInteractionEnabled=!0,U.onTapDown(()=>{U.isUserInteractionEnabled=!1,C.removeAllChildren(),e.end()}),C.addChild(U),C.onSetup(()=>{e.removeAllFreeNodes()})}}export{ge as ColorDots};
