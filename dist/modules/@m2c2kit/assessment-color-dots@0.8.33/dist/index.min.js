import{Game as _e,WebColors as y,RandomDraws as M,Sprite as Te,Scene as U,M2Error as ee,Transition as le,Shape as I,Label as V,Action as O,Timer as k,LabelHorizontalAlignmentMode as be,Equal as te,Easings as ye,TransitionDirection as we}from"@m2c2kit/core";import{LocalePicker as Ne,Instructions as oe,CountdownScene as Se,Grid as Ee,Button as ne}from"@m2c2kit/addons";class b extends Error{constructor(...e){super(...e),this.name="M2Error",Object.setPrototypeOf(this,b.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,b)}}class T{constructor(e,t){if(this._groups=new Array,!Array.isArray(e))throw new b("DataCalc constructor expects an array of observations as first argument");for(let i=0;i<e.length;i++)if(e[i]===null||typeof e[i]!="object"||Array.isArray(e[i]))throw new b(`DataCalc constructor expects all elements to be objects (observations). Element at index ${i} is ${typeof e[i]}. Element: ${JSON.stringify(e[i])}`);this._observations=this.deepCopy(e);const o=new Set;for(const i of e)for(const r of Object.keys(i))o.add(r);for(const i of this._observations)for(const r of o)r in i||(i[r]=null);t?.groups&&(this._groups=Array.from(t.groups))}get groups(){return this._groups}get observations(){return this._observations}get rows(){return this._observations}pull(e){if(this._observations.length===0)return console.warn(`DataCalc.pull(): No observations available to pull variable "${e}" from. Returning null.`),null;this.verifyObservationsContainVariable(e);const t=this._observations.map(o=>o[e]);return t.length===1?t[0]:t}get length(){return this._observations.length}filter(e){if(this._groups.length>0)throw new b(`filter() cannot be used on grouped data. The data are currently grouped by ${this._groups.join(", ")}. Ungroup the data first using ungroup().`);return new T(this._observations.filter(e),{groups:this._groups})}groupBy(...e){return e.forEach(t=>{this.verifyObservationsContainVariable(t)}),new T(this._observations,{groups:e})}ungroup(){return new T(this._observations)}mutate(e){if(this._groups.length>0)throw new b(`mutate() cannot be used on grouped data. The data are currently grouped by ${this._groups.join(", ")}. Ungroup the data first using ungroup().`);const t=this._observations.map(o=>{let i={...o};for(const[r,n]of Object.entries(e))i={...i,[r]:n(o)};return i});return new T(t,{groups:this._groups})}summarize(e){if(this._groups.length===0){const t={};for(const[o,i]of Object.entries(e))if(typeof i=="object"&&i!==null&&"summarizeFunction"in i){const r=i;t[o]=r.summarizeFunction(this,r.parameters,r.options)}else t[o]=i;return new T([t],{groups:this._groups})}return this.summarizeByGroups(e)}summarizeByGroups(e){const t=new Map;this._observations.forEach(i=>{const r=this._groups.map(s=>typeof i[s]=="object"?JSON.stringify(i[s]):i[s]).join("|");t.has(r)||t.set(r,[]);const n=t.get(r);n?n.push(i):t.set(r,[i])});const o=[];return t.forEach((i,r)=>{const n=r.split("|"),s=i[0],a={};this._groups.forEach((d,m)=>{const p=n[m],g=typeof s[d];if(g==="number")a[d]=Number(p);else if(g==="boolean")a[d]=p==="true";else if(p.startsWith("{")||p.startsWith("["))try{a[d]=JSON.parse(p)}catch{throw new b(`Failed to parse group value ${p} as JSON for group ${d}`)}else a[d]=p});const l=new T(i);for(const[d,m]of Object.entries(e))if(typeof m=="object"&&m!==null&&"summarizeFunction"in m){const p=m;a[d]=p.summarizeFunction(l,p.parameters,p.options)}else a[d]=m;o.push(a)}),new T(o,{groups:this._groups})}select(...e){const t=[],o=[];e.forEach(s=>{s.startsWith("-")?o.push(s.substring(1)):t.push(s)}),[...t.length>0?t:Object.keys(this._observations[0]||{}),...o].forEach(s=>{this.verifyObservationsContainVariable(s)});const r=new Set(o),n=this._observations.map(s=>{const a={};return t.length>0?t.forEach(l=>{r.has(l)||(a[l]=s[l])}):Object.keys(s).forEach(l=>{r.has(l)||(a[l]=s[l])}),a});return new T(n,{groups:this._groups})}arrange(...e){if(this._groups.length>0)throw new b(`arrange() cannot be used on grouped data. The data are currently grouped by ${this._groups.join(", ")}. Ungroup the data first using ungroup().`);const t=[...this._observations].sort((o,i)=>{for(const r of e){let n=r,s=1;if(r.startsWith("-")&&(n=r.substring(1),s=-1),!(n in o)||!(n in i))throw new b(`arrange(): variable ${n} does not exist in all observations`);const a=o[n],l=i[n];if(typeof a!=typeof l)return s*(String(a)<String(l)?-1:1);if(a<l)return-1*s;if(a>l)return 1*s}return 0});return new T(t,{groups:this._groups})}distinct(){const e=new Set,t=this._observations.filter(o=>{const i=JSON.stringify(this.normalizeForComparison(o));return e.has(i)?!1:(e.add(i),!0)});return new T(t,{groups:this._groups})}rename(e){if(this._observations.length===0)throw new b("Cannot rename variables on an empty dataset");Object.values(e).forEach(o=>{this.verifyObservationsContainVariable(o)});const t=this._observations.map(o=>{const i={};for(const[r,n]of Object.entries(o)){const s=Object.entries(e).find(([,a])=>a===r)?.[0];s?i[s]=n:Object.values(e).includes(r)||(i[r]=n)}return i});return new T(t,{groups:this._groups})}innerJoin(e,t){if(this._groups.length>0||e._groups.length>0)throw new b("innerJoin() cannot be used on grouped data. Ungroup the data first using ungroup().");t.forEach(r=>{this.verifyObservationsContainVariable(r),e.verifyObservationsContainVariable(r)});const o=new Map;e.observations.forEach(r=>{if(this.hasNullJoinKeys(r,t))return;const n=t.map(a=>JSON.stringify(this.normalizeForComparison(r[a]))).join("|"),s=o.get(n)||[];s.push(r),o.set(n,s)});const i=[];return this._observations.forEach(r=>{if(this.hasNullJoinKeys(r,t))return;const n=t.map(a=>JSON.stringify(this.normalizeForComparison(r[a]))).join("|"),s=o.get(n)||[];s.length>0&&s.forEach(a=>{const l={...r};Object.entries(a).forEach(([d,m])=>{t.includes(d)||(l[d]=m)}),i.push(l)})}),new T(i)}leftJoin(e,t){if(this._groups.length>0||e._groups.length>0)throw new b("leftJoin() cannot be used on grouped data. Ungroup the data first using ungroup().");t.forEach(r=>{this.verifyObservationsContainVariable(r),e.verifyObservationsContainVariable(r)});const o=new Map;e.observations.forEach(r=>{if(this.hasNullJoinKeys(r,t))return;const n=t.map(a=>JSON.stringify(this.normalizeForComparison(r[a]))).join("|"),s=o.get(n)||[];s.push(r),o.set(n,s)});const i=[];return this._observations.forEach(r=>{if(this.hasNullJoinKeys(r,t)){i.push({...r});return}const n=t.map(a=>JSON.stringify(this.normalizeForComparison(r[a]))).join("|"),s=o.get(n)||[];s.length>0?s.forEach(a=>{const l={...r};Object.entries(a).forEach(([d,m])=>{t.includes(d)||(l[d]=m)}),i.push(l)}):i.push({...r})}),new T(i)}rightJoin(e,t){if(this._groups.length>0||e._groups.length>0)throw new b("rightJoin() cannot be used on grouped data. Ungroup the data first using ungroup().");t.forEach(n=>{this.verifyObservationsContainVariable(n),e.verifyObservationsContainVariable(n)});const o=new Map;e.observations.forEach(n=>{if(this.hasNullJoinKeys(n,t))return;const s=t.map(l=>JSON.stringify(this.normalizeForComparison(n[l]))).join("|"),a=o.get(s)||[];a.push(n),o.set(s,a)});const i=[],r=new Set;return this._observations.forEach(n=>{if(this.hasNullJoinKeys(n,t))return;const s=t.map(l=>JSON.stringify(this.normalizeForComparison(n[l]))).join("|"),a=o.get(s)||[];a.length>0&&(a.forEach(l=>{const d={...n};Object.entries(l).forEach(([m,p])=>{t.includes(m)||(d[m]=p)}),i.push(d)}),r.add(s))}),e.observations.forEach(n=>{if(this.hasNullJoinKeys(n,t)){i.push({...n});return}const s=t.map(a=>JSON.stringify(this.normalizeForComparison(n[a]))).join("|");r.has(s)||(i.push({...n}),r.add(s))}),new T(i)}fullJoin(e,t){if(this._groups.length>0||e._groups.length>0)throw new b("fullJoin() cannot be used on grouped data. Ungroup the data first using ungroup().");t.forEach(n=>{this.verifyObservationsContainVariable(n),e.verifyObservationsContainVariable(n)});const o=new Map;e.observations.forEach(n=>{if(this.hasNullJoinKeys(n,t))return;const s=t.map(l=>JSON.stringify(this.normalizeForComparison(n[l]))).join("|"),a=o.get(s)||[];a.push(n),o.set(s,a)});const i=[],r=new Set;return this._observations.forEach(n=>{if(this.hasNullJoinKeys(n,t)){i.push({...n});return}const s=t.map(l=>JSON.stringify(this.normalizeForComparison(n[l]))).join("|"),a=o.get(s)||[];a.length>0?(a.forEach(l=>{const d={...n};Object.entries(l).forEach(([m,p])=>{t.includes(m)||(d[m]=p)}),i.push(d)}),r.add(s)):i.push({...n})}),e.observations.forEach(n=>{if(this.hasNullJoinKeys(n,t)){i.push({...n});return}const s=t.map(a=>JSON.stringify(this.normalizeForComparison(n[a]))).join("|");r.has(s)||(i.push({...n}),r.add(s))}),new T(i)}slice(e,t){if(this._groups.length>0)throw new b("slice() cannot be used on grouped data. Ungroup the data first using ungroup().");let o;if(e>=this._observations.length)return new T([],{groups:this._groups});if(t===void 0){const i=e<0?this._observations.length+e:e;o=[this._observations[i]]}else o=this._observations.slice(e,t);return new T(o,{groups:this._groups})}bindRows(e){if(this._observations.length>0&&e.observations.length>0){const t=new Set(Object.keys(this._observations[0])),o=new Set(Object.keys(e.observations[0]));[...t].filter(r=>o.has(r)).forEach(r=>{const n=this.getVariableType(r),s=e.getVariableType(r);n!==s&&console.warn(`Warning: bindRows() is combining datasets with different data types for variable '${r}'. Left dataset has type '${n}' and right dataset has type '${s}'.`)})}return new T([...this._observations,...e.observations])}getVariableType(e){if(this._observations.length===0)return"unknown";const t={};this._observations.forEach(r=>{if(e in r){const n=r[e],s=n===null?"null":Array.isArray(n)?"array":typeof n;t[s]=(t[s]||0)+1}});let o=0,i="unknown";for(const[r,n]of Object.entries(t))n>o&&(o=n,i=r);return i}verifyObservationsContainVariable(e){if(!this._observations.every(t=>e in t))throw new b(`Variable ${e} does not exist for each item (row) in the data array.`)}variableExists(e){return this._observations.some(t=>e in t)}isNonMissingNumeric(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}isMissingNumeric(e){return typeof e=="number"&&(isNaN(e)||!isFinite(e))||e===null||typeof e>"u"}normalizeForComparison(e){return e===null||typeof e!="object"?e:Array.isArray(e)?e.map(t=>this.normalizeForComparison(t)):Object.keys(e).sort().reduce((t,o)=>(t[o]=this.normalizeForComparison(e[o]),t),{})}deepCopy(e,t=new WeakMap){if(e===null||typeof e!="object")return e;if(t.has(e))return t.get(e);const o=Array.isArray(e)?[]:Object.create(Object.getPrototypeOf(e));t.set(e,o);const i=[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)];for(const r of i){const n=Object.getOwnPropertyDescriptor(e,r);n&&Object.defineProperty(o,r,{...n,value:this.deepCopy(e[r],t)})}return o}hasNullJoinKeys(e,t){return t.some(o=>e[o]===null||e[o]===void 0)}}const ce={"+":1,"-":1,"*":2,"/":2,"^":3};class X{constructor(e,t,o,i){this.leafFn=e,this.parameters=t,this.options=o,i&&i.length>0?this.tokens=i.slice():e?this.tokens=[{t:"operand",v:this}]:this.tokens=[],this.summarizeFunction=r=>this.evaluateAsValue(r)}static leaf(e,t,o){return new X(e,t,o)}cloneWithTokens(e){return new X(void 0,void 0,void 0,e)}appendOp(e,t){const o=this.tokens.slice();return o.push({t:"op",v:e}),o.push({t:"operand",v:t}),this.cloneWithTokens(o)}add(e){return this.appendOp("+",e)}sub(e){return this.appendOp("-",e)}mul(e){return this.appendOp("*",e)}div(e){return this.appendOp("/",e)}pow(e){return this.appendOp("^",e)}evaluateOperandToNumber(e,t){if(typeof e=="number")return e;const o=Array.isArray(e.parameters)?e.parameters:e.parameters===void 0?void 0:[e.parameters],i=e.leafFn?e.leafFn(t,o,e.options):e.evaluateAsValue(t);if(i==null)return NaN;const r=Number(i);return typeof r=="number"&&!isNaN(r)?r:NaN}evaluateFlatTokens(e,t){const o=[],i=[];for(const n of e)n.t==="operand"?o.push(n.v):i.push(n.v);if(o.length===0)return NaN;for(;i.length>0;){let n=0,s=ce[i[0]]??0;for(let C=1;C<i.length;C++){const F=ce[i[C]]??0;(F>s||F===s&&i[C]==="^")&&(s=F,n=C)}const a=i.splice(n,1)[0],l=o.splice(n,1)[0],d=o.splice(n,1)[0],m=this.evaluateOperandToNumber(l,t),p=this.evaluateOperandToNumber(d,t);let g=NaN;a==="+"?g=m+p:a==="-"?g=m-p:a==="*"?g=m*p:a==="/"?g=p===0?NaN:m/p:a==="^"&&(g=Math.pow(m,p)),o.splice(n,0,g)}const r=o[0];return typeof r=="number"?r:this.evaluateOperandToNumber(r,t)}parens(){return Oe(this)}evaluateAsValue(e){if(this.leafFn){const o=Array.isArray(this.parameters)?this.parameters:this.parameters===void 0?void 0:[this.parameters],i=this.leafFn(e,o,this.options);return typeof i=="number"&&Number.isNaN(i)?null:i}if(!this.tokens||this.tokens.length===0)return NaN;const t=this.evaluateFlatTokens(this.tokens,e);return typeof t=="number"&&Number.isNaN(t)?null:t}}function Oe(f){const e=[{t:"operand",v:f}];return new X(void 0,void 0,void 0,e)}const Ce={coerceBooleans:!0,skipMissing:!1};function q(f){return{...Ce,...f}}function ve(f,e,t,o,i,r){const n=q(t);f.verifyObservationsContainVariable(e);let s=0,a=r,l=!1;return f.observations.forEach(d=>{if(f.isNonMissingNumeric(d[e])){a=o(d[e],a),s++;return}if(typeof d[e]=="boolean"&&n.coerceBooleans){a=o(d[e]?1:0,a),s++;return}if(f.isMissingNumeric(d[e])){l=!0;return}throw new b(`${i}: variable ${e} has non-numeric value ${d[e]} in this observation: ${JSON.stringify(d)}`)}),{state:a,count:s,containsMissing:l}}function xe(f,e,t,o,i){const r=q(e);let n=i,s=0,a=!1;for(const l of f)if(typeof l=="number"&&!isNaN(l)&&isFinite(l))n=t(l,n),s++;else if(typeof l=="boolean"&&r.coerceBooleans)n=t(l?1:0,n),s++;else if(l==null||typeof l=="number"&&(isNaN(l)||!isFinite(l)))a=!0;else throw new b(`${o}: has non-numeric value ${l}`);return{state:n,count:s,containsMissing:a}}function Ie(f,e,t){const o=q(e);if(typeof f=="number"&&!isNaN(f)&&isFinite(f))return{value:f,isMissing:!1};if(typeof f=="boolean"&&o.coerceBooleans)return{value:f?1:0,isMissing:!1};if(f==null||typeof f=="number"&&(isNaN(f)||!isFinite(f)))return{value:0,isMissing:!0};throw new b(`${t}: has non-numeric value ${f}`)}const ke=(f,e,t)=>{const o=e?e[0]:void 0,i=q(t);if(typeof o=="string"){if(!f.variableExists(o))return null;const n=ve(f,o,t,(s,a)=>a+s,"sum()",0);return n.containsMissing&&!i.skipMissing||n.count===0?null:n.state}else if(Array.isArray(o)){const r=xe(o,t,(n,s)=>s+n,"sum()",0);return r.containsMissing&&!i.skipMissing||r.count===0?null:r.state}else{const r=Ie(o,t,"sum()");return r.isMissing&&!i.skipMissing||r.isMissing?null:r.value}};function Ae(f,e){return X.leaf(ke,[f],e)}console.log("\u26AA @m2c2kit/data-calc version 0.8.6 (c86b5047)");class De extends _e{constructor(){const e={fixation_duration_ms:{default:500,description:"How long fixation scene is shown, milliseconds.",type:"number"},dot_colors:{type:"array",description:"Array of colors for dots.",items:{type:"object",properties:{colorName:{type:"string",description:"Human-friendly name of color."},rgbaColor:{type:"array",description:"Color as array, [r,g,b,a].",items:{type:"number"}}}},default:[{colorName:"black",rgbaColor:[0,0,0,1]},{colorName:"green",rgbaColor:[0,158,115,1]},{colorName:"yellow",rgbaColor:[240,228,66,1]},{colorName:"blue",rgbaColor:[0,114,178,1]},{colorName:"orange",rgbaColor:[213,94,0,1]},{colorName:"pink",rgbaColor:[204,121,167,1]}]},dot_diameter:{default:48,description:"Diameter of dots.",type:"number"},number_of_dots:{default:3,description:"How many dots to present. Must be at least 3.",type:"integer"},dot_present_duration_ms:{default:1e3,description:"How long the dots are shown, milliseconds.",type:"number"},dot_blank_duration_ms:{default:750,description:"How long to show a blank square after dots are removed, milliseconds.",type:"number"},color_selected_hold_duration_ms:{default:500,description:"How long to show a square with the dot colored by the user's choice, before advancing to next scene, milliseconds.",type:"number"},number_of_trials:{default:5,description:"How many trials to run.",type:"integer"},show_trials_complete_scene:{default:!0,type:"boolean",description:"After the final trial, should a completion scene be shown? Otherwise, the game will immediately end."},instruction_type:{default:"long",description:"Type of instructions to show, 'short' or 'long'.",type:"string",enum:["short","long"]},instructions:{default:null,type:["object","null"],description:"When non-null, an InstructionsOptions object that will completely override the built-in instructions."},show_quit_button:{type:"boolean",default:!1,description:"Should the activity quit button be shown?"},show_fps:{type:"boolean",default:!1,description:"Should the FPS be shown?"},show_locale_picker:{type:"boolean",default:!1,description:"Should the icon that allows the participant to switch the locale be shown?"},seed:{type:["string","null"],default:null,description:"Optional seed for the seeded pseudo-random number generator. When null, the default Math.random() is used."},scoring:{type:"boolean",default:!1,description:"Should scoring data be generated? Default is false."}},t={activity_begin_iso8601_timestamp:{type:"string",format:"date-time",description:"ISO 8601 timestamp at the beginning of the game activity."},trial_begin_iso8601_timestamp:{type:["string","null"],format:"date-time",description:"ISO 8601 timestamp at the beginning of the trial. Null if trial was skipped."},trial_end_iso8601_timestamp:{type:["string","null"],format:"date-time",description:"ISO 8601 timestamp at the end of the trial (when user presses 'Done' after placing the dot). Null if trial was skipped."},trial_index:{type:["integer","null"],description:"Index of the trial within this assessment, 0-based."},square_side_length:{type:["number","null"],description:"Length of square side, in pixels. This is the square in which the dots are shown. Null if trial was skipped."},presented_dots:{description:"Configuration of dots presented to the user. Null if trial was skipped.",type:["array","null"],items:{type:"object",properties:{color_name:{type:"string",description:"Human-friendly name of color."},rgba_color:{type:"array",description:"Color as array, [r,g,b,a].",items:{type:"number"}},location:{type:"object",description:"Location of dot.",properties:{x:{type:"number",description:"X coordinate of dot."},y:{type:"number",description:"Y coordinate of dot."}}}}}},color_target_dot_index:{description:"Index (0-based) of presented dot whose color the user was asked to recall. Null if trial was skipped.",type:["integer","null"]},color_selected:{description:"Color selected by user. Null if trial was skipped.",type:["object","null"],properties:{color_name:{type:"string",description:"Human-friendly name of color."},rgba_color:{type:"array",description:"Color as array, [r,g,b,a].",items:{type:"number"}}}},color_selected_correct:{type:["boolean","null"],description:"Was the color selected by the user correct? Null if trial was skipped."},location_target_dot_index:{description:"Index (0-based) of presented dot whose location the user was asked to recall. Null if trial was skipped.",type:["integer","null"]},location_selected:{description:"Location selected by user. Null if trial was skipped.",type:["object","null"],properties:{x:{type:"number",description:"X coordinate of dot."},y:{type:"number",description:"Y coordinate of dot."}}},location_selected_delta:{type:["number","null"],description:"Euclidean distance between location target dot and the location selected by user. Null if trial was skipped."},color_selection_response_time_ms:{type:["number","null"],description:"Milliseconds from the beginning of color selection task until the user taps the done button. Null if trial was skipped."},location_selection_response_time_ms:{type:["number","null"],description:"Milliseconds from the beginning of location selection task until the user taps the done button. Null if trial was skipped."},quit_button_pressed:{type:"boolean",description:"Was the quit button pressed?"}},o={activity_begin_iso8601_timestamp:{type:"string",format:"date-time",description:"ISO 8601 timestamp at the beginning of the game activity."},first_trial_begin_iso8601_timestamp:{type:["string","null"],format:"date-time",description:"ISO 8601 timestamp at the beginning of the first trial. Null if no trials were completed."},last_trial_end_iso8601_timestamp:{type:["string","null"],format:"date-time",description:"ISO 8601 timestamp at the end of the last trial. Null if no trials were completed."},n_trials:{type:"integer",description:"Number of trials completed."},flag_trials_match_expected:{type:"integer",description:"Does the number of completed and expected trials match? 1 = true, 0 = false."},participant_score:{type:["number","null"],description:"Participant-facing score. It is a weighted score of color identification and location accuracy. This is a simple metric to provide feedback to the participant. Null if no trials attempted."}},r={name:"Color Dots",id:"color-dots",publishUuid:"72a1ef60-75c0-47b3-921c-aaee72cca9da",version:"0.8.33 (c86b5047)",moduleMetadata:{name:"@m2c2kit/assessment-color-dots",version:"0.8.33",dependencies:{"@m2c2kit/addons":"0.3.34","@m2c2kit/core":"0.3.35"}},translation:{configuration:{baseLocale:"en-US"},"en-US":{localeName:"English",INSTRUCTIONS_TITLE:"Color Dots",SHORT_INSTRUCTIONS_TEXT_PAGE_1:"For this activity, try to remember the location and color of 3 dots.",INSTRUCTIONS_TEXT_PAGE_1:"For this activity, try to remember the location and color of 3 dots.",INSTRUCTIONS_TEXT_PAGE_2:"Choose the color of the dot from the options at the bottom of the screen.",INSTRUCTIONS_TEXT_PAGE_3:"Next you are asked to place another dot. Touch the screen where you remember seeing the dot.",WHAT_COLOR:"What color was this dot?",WHERE_WAS:"Where was this dot?",TOUCH_TO_MOVE:"Touch the screen to move the dot",DONE_BUTTON_TEXT:"Done",START_BUTTON_TEXT:"START",NEXT_BUTTON_TEXT:"Next",BACK_BUTTON_TEXT:"Back",GET_READY_COUNTDOWN_TEXT:"GET READY!",TRIALS_COMPLETE_SCENE_TEXT:"This activity is complete.",TRIALS_COMPLETE_SCENE_BUTTON_TEXT:"OK"},"es-MX":{localeName:"Espa\xF1ol",INSTRUCTIONS_TITLE:"Puntos de Color",SHORT_INSTRUCTIONS_TEXT_PAGE_1:"Para esta actividad, intenta recordar la ubicaci\xF3n y el color de 3 puntos.",INSTRUCTIONS_TEXT_PAGE_1:"Para esta actividad, intenta recordar la ubicaci\xF3n y el color de 3 puntos.",INSTRUCTIONS_TEXT_PAGE_2:"Escoja el color del punto de las opciones en la parte de abajo de la pantalla.",INSTRUCTIONS_TEXT_PAGE_3:"Luego, se te pedir\xE1 que coloques otro punto. Toca la pantalla donde recuerdas haber visto el punto.",WHAT_COLOR:"\xBFDe qu\xE9 color era este punto?",WHERE_WAS:"\xBFD\xF3nde estaba este punto?",TOUCH_TO_MOVE:"Toca la pantalla para mover el punto",DONE_BUTTON_TEXT:"Listo",START_BUTTON_TEXT:"COMENZAR",NEXT_BUTTON_TEXT:"Siguiente",BACK_BUTTON_TEXT:"Atr\xE1s",GET_READY_COUNTDOWN_TEXT:"PREP\xC1RESE",TRIALS_COMPLETE_SCENE_TEXT:"Esta actividad est\xE1 completa.",TRIALS_COMPLETE_SCENE_BUTTON_TEXT:"OK"}},shortDescription:"Color Dots is cued-recall, item-location memory binding task, where after viewing 3 dots for a brief period of time, participants report: (1) the color at a cued location; (2) the location of a cued color.",longDescription:"Participants are asked to remember the location and color of three briefly presented, and uniquely colored dots. Each trial of this task requires two responses (subsequently referred to as stage 1 and stage 2 in the list of outcome variables): (1) reporting the color at a cued location; (2) reporting the location where a circular of a specified color previously appeared.",showFps:e.show_fps.default,width:400,height:800,bodyBackgroundColor:y.White,trialSchema:t,scoringSchema:o,parameters:e,fonts:[{fontName:"roboto",url:"fonts/roboto/Roboto-Regular.ttf"}],images:[{imageName:"cd1",height:450,width:350,url:"images/cd1.png"},{imageName:"cd2",height:450,width:350,url:"images/cd2.png",localize:!0},{imageName:"cd3",height:450,width:350,url:"images/cd3.png",localize:!0},{imageName:"circle-x",height:32,width:32,url:"images/circle-x.svg"}]};super(r)}async initialize(){await super.initialize();const e=this,t=e.getParameter("seed");typeof t=="string"&&M.setSeed(t);const o=350;if(e.getParameter("show_quit_button")){const c=new Te({imageName:"circle-x",position:{x:380,y:20},isUserInteractionEnabled:!0});e.addFreeNode(c),c.onTapDown(u=>{e.removeAllFreeNodes(),u.handled=!0;const _=new U;if(e.addScene(_),e.presentScene(_),e.addTrialData("quit_button_pressed",!0),e.trialComplete(),e.getParameter("scoring")){const h=e.calculateScores([],{numberOfTrials:e.getParameter("number_of_trials"),dotDiameter:e.getParameter("dot_diameter")});e.addScoringData(h),e.scoringComplete()}e.cancel()})}let i;e.getParameter("show_locale_picker")&&(i=new Ne,e.addFreeNode(i));let r,n,s;const a=e.getParameter("instructions");if(a)s=oe.create(a);else switch(e.getParameter("instruction_type")){case"short":{s=oe.create({instructionScenes:[{title:"INSTRUCTIONS_TITLE",text:"SHORT_INSTRUCTIONS_TEXT_PAGE_1",imageName:"cd1",imageAboveText:!1,textFontSize:24,titleFontSize:30,textVerticalBias:.2,nextButtonText:"START_BUTTON_TEXT",nextButtonBackgroundColor:y.Green}]});break}case"long":{s=oe.create({instructionScenes:[{title:"INSTRUCTIONS_TITLE",text:"INSTRUCTIONS_TEXT_PAGE_1",imageName:"cd1",imageAboveText:!1,textFontSize:24,titleFontSize:30,textVerticalBias:.2,nextButtonText:"NEXT_BUTTON_TEXT",backButtonText:"BACK_BUTTON_TEXT"},{title:"INSTRUCTIONS_TITLE",text:"INSTRUCTIONS_TEXT_PAGE_2",imageName:"cd2",imageAboveText:!1,textFontSize:24,titleFontSize:30,textVerticalBias:.15,nextButtonText:"NEXT_BUTTON_TEXT",backButtonText:"BACK_BUTTON_TEXT"},{title:"INSTRUCTIONS_TITLE",text:"INSTRUCTIONS_TEXT_PAGE_3",imageName:"cd3",imageAboveText:!1,imageMarginTop:8,textFontSize:24,titleFontSize:30,textVerticalBias:.15,nextButtonText:"START_BUTTON_TEXT",nextButtonBackgroundColor:y.Green,backButtonText:"BACK_BUTTON_TEXT"}]});break}default:throw new ee("invalid value for instruction_type")}s[0].onAppear(()=>{e.addTrialData("activity_begin_iso8601_timestamp",this.beginIso8601Timestamp)}),e.addScenes(s);const l=new Se({milliseconds:3e3,text:"GET_READY_COUNTDOWN_TEXT",zeroDwellMilliseconds:1e3,transition:le.none()});e.addScene(l);const d=[],m=e.getParameter("number_of_dots"),p=e.getParameter("dot_colors"),g=e.getParameter("dot_diameter"),C=p.length;function F(c,u,_){for(let h=0;h<_.length;h++)if(Math.sqrt(Math.pow(c-_[h].x,2)+Math.pow(u-_[h].y,2))<g*3+.25*g)return!0;return!1}for(let c=0;c<e.getParameter("number_of_trials");c++){const u=JSON.parse(JSON.stringify(p)),_=new Array;for(let w=0;w<m;w++){let S,z;do S=M.singleFromRange(0+g/2+4,o-g/2-4),z=M.singleFromRange(0+g/2+4,o-g/2-4);while(F(S,z,_));const me=M.singleFromRange(0,u.length-1),ae=u.splice(me,1)[0],ge={x:S,y:z,rgbaColor:ae.rgbaColor,colorName:ae.colorName};_.push(ge)}const h=M.singleFromRange(0,_.length-1);d.push({colorSelectionDotIndex:h,locationSelectionDotIndex:NaN,dots:_})}const A=new U;e.addScene(A);const ie=new I({rect:{size:{width:o,height:o}},fillColor:y.Transparent,strokeColor:y.Gray,lineWidth:4,position:{x:200,y:300}});A.addChild(ie);const de=new V({text:"+",fontSize:32,fontColor:y.Black,localize:!1});ie.addChild(de),A.onSetup(()=>{A.run(O.sequence([O.wait({duration:e.getParameter("fixation_duration_ms")}),O.custom({callback:()=>{e.presentScene(B)}})]))}),A.onAppear(()=>{e.addTrialData("activity_begin_iso8601_timestamp",this.beginIso8601Timestamp),e.addTrialData("trial_begin_iso8601_timestamp",new Date().toISOString())});const B=new U;e.addScene(B);const J=new I({rect:{size:{width:o,height:o}},fillColor:y.Transparent,strokeColor:y.Gray,lineWidth:4,position:{x:200,y:300}});B.addChild(J);const G=new Array;B.onSetup(()=>{G.length=0;const c=d[e.trialIndex];for(const u of c.dots){const _={x:u.x,y:u.y,rgbaColor:u.rgbaColor,colorName:u.colorName,shape:new I({circleOfRadius:g/2,fillColor:u.rgbaColor,position:{x:u.x-o/2,y:u.y-o/2}})};G.push(_),J.addChild(_.shape)}B.run(O.sequence([O.wait({duration:e.getParameter("dot_present_duration_ms")}),O.custom({callback:()=>{J.removeAllChildren()}}),O.wait({duration:e.getParameter("dot_blank_duration_ms")}),O.custom({callback:()=>{e.presentScene(v)}})]))});const v=new U;e.addScene(v);const H=new I({rect:{size:{width:o,height:o}},fillColor:y.Transparent,strokeColor:y.Gray,lineWidth:4,position:{x:200,y:300}});v.addChild(H);const $=new V({text:"WHAT_COLOR",fontSize:24,position:{x:200,y:75}});v.addChild($);const K=new I({position:{x:200,y:530},fillColor:y.Transparent,strokeColor:y.Black,lineWidth:2,rect:{width:350,height:60}});v.addChild(K);const j=new Ee({position:{x:200,y:530},rows:1,columns:C,size:{width:350,height:60},backgroundColor:y.Transparent,gridLineColor:y.Transparent});v.addChild(j);let re=-1;const D=new ne({position:{x:200,y:650},text:"DONE_BUTTON_TEXT",hidden:!0});D.onTapDown(()=>{k.stop("colorRt"),re=k.elapsed("colorRt"),k.remove("colorRt"),e.addTrialData("color_selection_response_time_ms",re),$.hidden=!0,K.hidden=!0,j.hidden=!0,D.hidden=!0,D.run(O.sequence([O.wait({duration:e.getParameter("color_selected_hold_duration_ms")}),O.custom({callback:()=>{if(!n)throw new ee("no selected color");r={color_name:p.filter(h=>te.rgbaColor(h.rgbaColor,n))[0].colorName,rgba_color:n},e.addTrialData("color_selected",r);const u=d[e.trialIndex],_=u.dots[u.colorSelectionDotIndex];e.addTrialData("color_selected_correct",te.rgbaColor(_.rgbaColor,n)),e.presentScene(E)}})]))}),v.addChild(D),v.onSetup(()=>{$.hidden=!1,K.hidden=!1,j.hidden=!1,H.removeAllChildren();const u=d[e.trialIndex].colorSelectionDotIndex,_=G[u].shape.duplicate();_.fillColor=y.Transparent,_.strokeColor=y.Black,_.lineWidth=2,H.addChild(_),j.removeAllGridChildren();for(let h=0;h<C;h++){const w=new I({circleOfRadius:g/2,fillColor:p[h].rgbaColor,isUserInteractionEnabled:!0});w.size={width:g,height:g},w.onTapDown(()=>{_.fillColor=w.fillColor,D.hidden=!1,D.isUserInteractionEnabled=!0,n=w.fillColor}),j.addAtCell(w,0,h)}}),v.onAppear(()=>{k.startNew("colorRt")});const E=new U({isUserInteractionEnabled:!0});e.addScene(E);const R=new I({rect:{size:{width:o,height:o}},fillColor:y.Transparent,strokeColor:y.Gray,lineWidth:4,position:{x:200,y:300}});E.addChild(R),R.onPointerDown(()=>{L=!1});const ue=new V({text:"WHERE_WAS",fontSize:24,position:{x:165,y:75},preferredMaxLayoutWidth:285,horizontalAlignmentMode:be.Left});E.addChild(ue);const pe=new V({text:"TOUCH_TO_MOVE",fontSize:24,position:{x:200,y:530}});E.addChild(pe);let N,Y;function Z(c){const u=Q(c);return!(u.x<g/2||u.x+g/2>o||u.y<g/2||u.y+g/2>o)}function he(c){const u=Q(c);return!(u.x<0||u.x>o||u.y<0||u.y>o)}function Q(c){const u=R.position.x-o/2,_=R.position.y-o/2,h=c.x-u,w=c.y-_;return{x:h,y:w}}let L=!1;E.onPointerUp(c=>{L||he(c.point)&&(N.position={x:c.point.x,y:c.point.y},Z(N.position)?x.hidden=!1:x.hidden=!0)}),E.onSetup(()=>{const c=d[e.trialIndex],u=c.colorSelectionDotIndex;x.hidden=!0,R.removeAllChildren();const _=new I({circleOfRadius:g/2,fillColor:n,strokeColor:y.Black,lineWidth:2,position:{x:c.dots[u].x-o/2,y:c.dots[u].y-o/2}});R.addChild(_);let h=-1;do h=M.singleFromRange(0,m-1),te.rgbaColor(c.dots[h].rgbaColor,n)&&(h=-1),h===u&&(h=-1);while(h===-1);c.locationSelectionDotIndex=h,N=new I({circleOfRadius:g/2,fillColor:c.dots[h].rgbaColor,position:{x:345,y:75},isUserInteractionEnabled:!0,draggable:!0}),E.addChild(N),Y={x:c.dots[h].x,y:c.dots[h].y,color_name:c.dots[h].colorName,color_rgba:c.dots[h].rgbaColor};const w=[];for(let S=0;S<c.dots.length;S++){const z={color_name:c.dots[S].colorName,rgba_color:c.dots[S].rgbaColor,location:{x:c.dots[S].x,y:c.dots[S].y}};w.push(z)}if(e.addTrialData("presented_dots",w),e.addTrialData("color_target_dot_index",c.colorSelectionDotIndex),e.addTrialData("location_target_dot_index",c.locationSelectionDotIndex),!n)throw new ee("no selected color!");_.fillColor=n,N.onTapDown(S=>{S.handled=!0}),N.onDragStart(()=>{L=!0}),N.onDrag(()=>{Z(N.position)?x.hidden=!1:x.hidden=!0}),N.onDragEnd(()=>{L=!1,Z(N.position)?x.hidden=!1:x.hidden=!0})}),E.onAppear(()=>{k.startNew("locationRt")});let se=-1;const x=new ne({position:{x:200,y:650},text:"DONE_BUTTON_TEXT",hidden:!0,isUserInteractionEnabled:!0});x.onTapDown(()=>{k.stop("locationRt"),se=k.elapsed("locationRt"),k.remove("locationRt"),e.addTrialData("location_selection_response_time_ms",se),e.addTrialData("trial_end_iso8601_timestamp",new Date().toISOString()),E.removeChild(N);const c=Q(N.position);e.addTrialData("location_selected",c),e.addTrialData("square_side_length",o);const u=Math.sqrt(Math.pow(c.x-Y.x,2)+Math.pow(c.y-Y.y,2));if(e.addTrialData("location_selected_delta",u),e.addTrialData("quit_button_pressed",!1),e.addTrialData("trial_index",e.trialIndex),e.trialComplete(),e.trialIndex<e.getParameter("number_of_trials"))e.presentScene(A);else{if(e.getParameter("scoring")){const _=e.calculateScores(e.data.trials,{numberOfTrials:e.getParameter("number_of_trials"),dotDiameter:e.getParameter("dot_diameter")});e.addScoringData(_),e.scoringComplete()}e.getParameter("show_trials_complete_scene")?e.presentScene(P,le.slide({direction:we.Left,duration:500,easing:ye.sinusoidalInOut})):e.end()}}),E.addChild(x);const P=new U;e.addScene(P);const fe=new V({text:"TRIALS_COMPLETE_SCENE_TEXT",position:{x:200,y:400}});P.addChild(fe);const W=new ne({text:"TRIALS_COMPLETE_SCENE_BUTTON_TEXT",position:{x:200,y:650}});W.isUserInteractionEnabled=!0,W.onTapDown(()=>{W.isUserInteractionEnabled=!1,P.removeAllChildren(),e.end()}),P.addChild(W),P.onSetup(()=>{e.removeAllFreeNodes()})}calculateScores(e,t){const o=(n,s,a)=>[{x:a,y:a},{x:n-a,y:a},{x:a,y:n-a},{x:n-a,y:n-a}].reduce((d,m)=>{const p=s.x-m.x,g=s.y-m.y,C=Math.sqrt(p*p+g*g);return Math.max(d,C)},0),i=new T(e);return i.mutate({trial_score:n=>{const s=o(n.square_side_length,n.presented_dots[n.location_target_dot_index].location,t.dotDiameter/2);return((n.color_selected_correct?.5:0)+(s-n.location_selected_delta)/s*.5)/t.numberOfTrials*100}}).summarize({activity_begin_iso8601_timestamp:this.beginIso8601Timestamp,first_trial_begin_iso8601_timestamp:i.arrange("trial_begin_iso8601_timestamp").slice(0).pull("trial_begin_iso8601_timestamp"),last_trial_end_iso8601_timestamp:i.arrange("-trial_end_iso8601_timestamp").slice(0).pull("trial_end_iso8601_timestamp"),n_trials:i.length,flag_trials_match_expected:i.length===t.numberOfTrials?1:0,participant_score:Ae("trial_score")}).observations}}export{De as ColorDots};
