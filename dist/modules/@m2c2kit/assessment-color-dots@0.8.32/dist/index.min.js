import{Game as me,WebColors as y,RandomDraws as U,Sprite as ge,Scene as M,M2Error as Z,Transition as se,Shape as v,Label as j,Action as O,Timer as I,LabelHorizontalAlignmentMode as _e,Equal as Q,Easings as Te,TransitionDirection as be}from"@m2c2kit/core";import{LocalePicker as ye,Instructions as ee,CountdownScene as we,Grid as Se,Button as te}from"@m2c2kit/addons";class b extends Error{constructor(...e){super(...e),this.name="M2Error",Object.setPrototypeOf(this,b.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,b)}}class T{constructor(e,t){if(this._groups=new Array,!Array.isArray(e))throw new b("DataCalc constructor expects an array of observations as first argument");for(let r=0;r<e.length;r++)if(e[r]===null||typeof e[r]!="object"||Array.isArray(e[r]))throw new b(`DataCalc constructor expects all elements to be objects (observations). Element at index ${r} is ${typeof e[r]}. Element: ${JSON.stringify(e[r])}`);this._observations=this.deepCopy(e);const n=new Set;for(const r of e)for(const i of Object.keys(r))n.add(i);for(const r of this._observations)for(const i of n)i in r||(r[i]=null);t?.groups&&(this._groups=Array.from(t.groups))}get groups(){return this._groups}get observations(){return this._observations}get rows(){return this._observations}pull(e){if(this._observations.length===0)return console.warn(`DataCalc.pull(): No observations available to pull variable "${e}" from. Returning null.`),null;this.verifyObservationsContainVariable(e);const t=this._observations.map(n=>n[e]);return t.length===1?t[0]:t}get length(){return this._observations.length}filter(e){if(this._groups.length>0)throw new b(`filter() cannot be used on grouped data. The data are currently grouped by ${this._groups.join(", ")}. Ungroup the data first using ungroup().`);return new T(this._observations.filter(e),{groups:this._groups})}groupBy(...e){return e.forEach(t=>{this.verifyObservationsContainVariable(t)}),new T(this._observations,{groups:e})}ungroup(){return new T(this._observations)}mutate(e){if(this._groups.length>0)throw new b(`mutate() cannot be used on grouped data. The data are currently grouped by ${this._groups.join(", ")}. Ungroup the data first using ungroup().`);const t=this._observations.map(n=>{let r={...n};for(const[i,o]of Object.entries(e))r={...r,[i]:o(n)};return r});return new T(t,{groups:this._groups})}summarize(e){if(this._groups.length===0){const t={};for(const[n,r]of Object.entries(e))if(typeof r=="object"&&r!==null&&"summarizeFunction"in r){const i=r;t[n]=i.summarizeFunction(this,i.parameters,i.options)}else t[n]=r;return new T([t],{groups:this._groups})}return this.summarizeByGroups(e)}summarizeByGroups(e){const t=new Map;this._observations.forEach(r=>{const i=this._groups.map(s=>typeof r[s]=="object"?JSON.stringify(r[s]):r[s]).join("|");t.has(i)||t.set(i,[]);const o=t.get(i);o?o.push(r):t.set(i,[r])});const n=[];return t.forEach((r,i)=>{const o=i.split("|"),s=r[0],a={};this._groups.forEach((d,m)=>{const g=o[m],_=typeof s[d];if(_==="number")a[d]=Number(g);else if(_==="boolean")a[d]=g==="true";else if(g.startsWith("{")||g.startsWith("["))try{a[d]=JSON.parse(g)}catch{throw new b(`Failed to parse group value ${g} as JSON for group ${d}`)}else a[d]=g});const l=new T(r);for(const[d,m]of Object.entries(e))if(typeof m=="object"&&m!==null&&"summarizeFunction"in m){const g=m;a[d]=g.summarizeFunction(l,g.parameters,g.options)}else a[d]=m;n.push(a)}),new T(n,{groups:this._groups})}select(...e){const t=[],n=[];e.forEach(s=>{s.startsWith("-")?n.push(s.substring(1)):t.push(s)}),[...t.length>0?t:Object.keys(this._observations[0]||{}),...n].forEach(s=>{this.verifyObservationsContainVariable(s)});const i=new Set(n),o=this._observations.map(s=>{const a={};return t.length>0?t.forEach(l=>{i.has(l)||(a[l]=s[l])}):Object.keys(s).forEach(l=>{i.has(l)||(a[l]=s[l])}),a});return new T(o,{groups:this._groups})}arrange(...e){if(this._groups.length>0)throw new b(`arrange() cannot be used on grouped data. The data are currently grouped by ${this._groups.join(", ")}. Ungroup the data first using ungroup().`);const t=[...this._observations].sort((n,r)=>{for(const i of e){let o=i,s=1;if(i.startsWith("-")&&(o=i.substring(1),s=-1),!(o in n)||!(o in r))throw new b(`arrange(): variable ${o} does not exist in all observations`);const a=n[o],l=r[o];if(typeof a!=typeof l)return s*(String(a)<String(l)?-1:1);if(a<l)return-1*s;if(a>l)return 1*s}return 0});return new T(t,{groups:this._groups})}distinct(){const e=new Set,t=this._observations.filter(n=>{const r=JSON.stringify(this.normalizeForComparison(n));return e.has(r)?!1:(e.add(r),!0)});return new T(t,{groups:this._groups})}rename(e){if(this._observations.length===0)throw new b("Cannot rename variables on an empty dataset");Object.values(e).forEach(n=>{this.verifyObservationsContainVariable(n)});const t=this._observations.map(n=>{const r={};for(const[i,o]of Object.entries(n)){const s=Object.entries(e).find(([,a])=>a===i)?.[0];s?r[s]=o:Object.values(e).includes(i)||(r[i]=o)}return r});return new T(t,{groups:this._groups})}innerJoin(e,t){if(this._groups.length>0||e._groups.length>0)throw new b("innerJoin() cannot be used on grouped data. Ungroup the data first using ungroup().");t.forEach(i=>{this.verifyObservationsContainVariable(i),e.verifyObservationsContainVariable(i)});const n=new Map;e.observations.forEach(i=>{if(this.hasNullJoinKeys(i,t))return;const o=t.map(a=>JSON.stringify(this.normalizeForComparison(i[a]))).join("|"),s=n.get(o)||[];s.push(i),n.set(o,s)});const r=[];return this._observations.forEach(i=>{if(this.hasNullJoinKeys(i,t))return;const o=t.map(a=>JSON.stringify(this.normalizeForComparison(i[a]))).join("|"),s=n.get(o)||[];s.length>0&&s.forEach(a=>{const l={...i};Object.entries(a).forEach(([d,m])=>{t.includes(d)||(l[d]=m)}),r.push(l)})}),new T(r)}leftJoin(e,t){if(this._groups.length>0||e._groups.length>0)throw new b("leftJoin() cannot be used on grouped data. Ungroup the data first using ungroup().");t.forEach(i=>{this.verifyObservationsContainVariable(i),e.verifyObservationsContainVariable(i)});const n=new Map;e.observations.forEach(i=>{if(this.hasNullJoinKeys(i,t))return;const o=t.map(a=>JSON.stringify(this.normalizeForComparison(i[a]))).join("|"),s=n.get(o)||[];s.push(i),n.set(o,s)});const r=[];return this._observations.forEach(i=>{if(this.hasNullJoinKeys(i,t)){r.push({...i});return}const o=t.map(a=>JSON.stringify(this.normalizeForComparison(i[a]))).join("|"),s=n.get(o)||[];s.length>0?s.forEach(a=>{const l={...i};Object.entries(a).forEach(([d,m])=>{t.includes(d)||(l[d]=m)}),r.push(l)}):r.push({...i})}),new T(r)}rightJoin(e,t){if(this._groups.length>0||e._groups.length>0)throw new b("rightJoin() cannot be used on grouped data. Ungroup the data first using ungroup().");t.forEach(o=>{this.verifyObservationsContainVariable(o),e.verifyObservationsContainVariable(o)});const n=new Map;e.observations.forEach(o=>{if(this.hasNullJoinKeys(o,t))return;const s=t.map(l=>JSON.stringify(this.normalizeForComparison(o[l]))).join("|"),a=n.get(s)||[];a.push(o),n.set(s,a)});const r=[],i=new Set;return this._observations.forEach(o=>{if(this.hasNullJoinKeys(o,t))return;const s=t.map(l=>JSON.stringify(this.normalizeForComparison(o[l]))).join("|"),a=n.get(s)||[];a.length>0&&(a.forEach(l=>{const d={...o};Object.entries(l).forEach(([m,g])=>{t.includes(m)||(d[m]=g)}),r.push(d)}),i.add(s))}),e.observations.forEach(o=>{if(this.hasNullJoinKeys(o,t)){r.push({...o});return}const s=t.map(a=>JSON.stringify(this.normalizeForComparison(o[a]))).join("|");i.has(s)||(r.push({...o}),i.add(s))}),new T(r)}fullJoin(e,t){if(this._groups.length>0||e._groups.length>0)throw new b("fullJoin() cannot be used on grouped data. Ungroup the data first using ungroup().");t.forEach(o=>{this.verifyObservationsContainVariable(o),e.verifyObservationsContainVariable(o)});const n=new Map;e.observations.forEach(o=>{if(this.hasNullJoinKeys(o,t))return;const s=t.map(l=>JSON.stringify(this.normalizeForComparison(o[l]))).join("|"),a=n.get(s)||[];a.push(o),n.set(s,a)});const r=[],i=new Set;return this._observations.forEach(o=>{if(this.hasNullJoinKeys(o,t)){r.push({...o});return}const s=t.map(l=>JSON.stringify(this.normalizeForComparison(o[l]))).join("|"),a=n.get(s)||[];a.length>0?(a.forEach(l=>{const d={...o};Object.entries(l).forEach(([m,g])=>{t.includes(m)||(d[m]=g)}),r.push(d)}),i.add(s)):r.push({...o})}),e.observations.forEach(o=>{if(this.hasNullJoinKeys(o,t)){r.push({...o});return}const s=t.map(a=>JSON.stringify(this.normalizeForComparison(o[a]))).join("|");i.has(s)||(r.push({...o}),i.add(s))}),new T(r)}slice(e,t){if(this._groups.length>0)throw new b("slice() cannot be used on grouped data. Ungroup the data first using ungroup().");let n;if(e>=this._observations.length)return new T([],{groups:this._groups});if(t===void 0){const r=e<0?this._observations.length+e:e;n=[this._observations[r]]}else n=this._observations.slice(e,t);return new T(n,{groups:this._groups})}bindRows(e){if(this._observations.length>0&&e.observations.length>0){const t=new Set(Object.keys(this._observations[0])),n=new Set(Object.keys(e.observations[0]));[...t].filter(i=>n.has(i)).forEach(i=>{const o=this.getVariableType(i),s=e.getVariableType(i);o!==s&&console.warn(`Warning: bindRows() is combining datasets with different data types for variable '${i}'. Left dataset has type '${o}' and right dataset has type '${s}'.`)})}return new T([...this._observations,...e.observations])}getVariableType(e){if(this._observations.length===0)return"unknown";const t={};this._observations.forEach(i=>{if(e in i){const o=i[e],s=o===null?"null":Array.isArray(o)?"array":typeof o;t[s]=(t[s]||0)+1}});let n=0,r="unknown";for(const[i,o]of Object.entries(t))o>n&&(n=o,r=i);return r}verifyObservationsContainVariable(e){if(!this._observations.every(t=>e in t))throw new b(`Variable ${e} does not exist for each item (row) in the data array.`)}variableExists(e){return this._observations.some(t=>e in t)}isNonMissingNumeric(e){return typeof e=="number"&&!isNaN(e)&&isFinite(e)}isMissingNumeric(e){return typeof e=="number"&&(isNaN(e)||!isFinite(e))||e===null||typeof e>"u"}normalizeForComparison(e){return e===null||typeof e!="object"?e:Array.isArray(e)?e.map(t=>this.normalizeForComparison(t)):Object.keys(e).sort().reduce((t,n)=>(t[n]=this.normalizeForComparison(e[n]),t),{})}deepCopy(e,t=new WeakMap){if(e===null||typeof e!="object")return e;if(t.has(e))return t.get(e);const n=Array.isArray(e)?[]:Object.create(Object.getPrototypeOf(e));t.set(e,n);const r=[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)];for(const i of r){const o=Object.getOwnPropertyDescriptor(e,i);o&&Object.defineProperty(n,i,{...o,value:this.deepCopy(e[i],t)})}return n}hasNullJoinKeys(e,t){return t.some(n=>e[n]===null||e[n]===void 0)}}const Ne={coerceBooleans:!0,skipMissing:!1};function L(f){return{...Ne,...f}}function Ee(f,e,t,n,r,i){const o=L(t);f.verifyObservationsContainVariable(e);let s=0,a=i,l=!1;return f.observations.forEach(d=>{if(f.isNonMissingNumeric(d[e])){a=n(d[e],a),s++;return}if(typeof d[e]=="boolean"&&o.coerceBooleans){a=n(d[e]?1:0,a),s++;return}if(f.isMissingNumeric(d[e])){l=!0;return}throw new b(`${r}: variable ${e} has non-numeric value ${d[e]} in this observation: ${JSON.stringify(d)}`)}),{state:a,count:s,containsMissing:l}}function Oe(f,e,t,n,r){const i=L(e);let o=r,s=0,a=!1;for(const l of f)if(typeof l=="number"&&!isNaN(l)&&isFinite(l))o=t(l,o),s++;else if(typeof l=="boolean"&&i.coerceBooleans)o=t(l?1:0,o),s++;else if(l==null||typeof l=="number"&&(isNaN(l)||!isFinite(l)))a=!0;else throw new b(`${n}: has non-numeric value ${l}`);return{state:o,count:s,containsMissing:a}}function Ce(f,e,t){const n=L(e);if(typeof f=="number"&&!isNaN(f)&&isFinite(f))return{value:f,isMissing:!1};if(typeof f=="boolean"&&n.coerceBooleans)return{value:f?1:0,isMissing:!1};if(f==null||typeof f=="number"&&(isNaN(f)||!isFinite(f)))return{value:0,isMissing:!0};throw new b(`${t}: has non-numeric value ${f}`)}const xe=(f,e,t)=>{const n=e[0],r=L(t);if(typeof n=="string"){if(!f.variableExists(n))return null;const o=Ee(f,n,t,(s,a)=>a+s,"sum()",0);return o.containsMissing&&!r.skipMissing||o.count===0?null:o.state}else if(Array.isArray(n)){const i=Oe(n,t,(o,s)=>s+o,"sum()",0);return i.containsMissing&&!r.skipMissing||i.count===0?null:i.state}else{const i=Ce(n,t,"sum()");return i.isMissing&&!r.skipMissing||i.isMissing?null:i.value}};function ve(f,e){return{summarizeFunction:xe,parameters:[f],options:e}}console.log("\u26AA @m2c2kit/data-calc version 0.8.5 (d289d12c)");class Ie extends me{constructor(){const e={fixation_duration_ms:{default:500,description:"How long fixation scene is shown, milliseconds.",type:"number"},dot_colors:{type:"array",description:"Array of colors for dots.",items:{type:"object",properties:{colorName:{type:"string",description:"Human-friendly name of color."},rgbaColor:{type:"array",description:"Color as array, [r,g,b,a].",items:{type:"number"}}}},default:[{colorName:"black",rgbaColor:[0,0,0,1]},{colorName:"green",rgbaColor:[0,158,115,1]},{colorName:"yellow",rgbaColor:[240,228,66,1]},{colorName:"blue",rgbaColor:[0,114,178,1]},{colorName:"orange",rgbaColor:[213,94,0,1]},{colorName:"pink",rgbaColor:[204,121,167,1]}]},dot_diameter:{default:48,description:"Diameter of dots.",type:"number"},number_of_dots:{default:3,description:"How many dots to present. Must be at least 3.",type:"integer"},dot_present_duration_ms:{default:1e3,description:"How long the dots are shown, milliseconds.",type:"number"},dot_blank_duration_ms:{default:750,description:"How long to show a blank square after dots are removed, milliseconds.",type:"number"},color_selected_hold_duration_ms:{default:500,description:"How long to show a square with the dot colored by the user's choice, before advancing to next scene, milliseconds.",type:"number"},number_of_trials:{default:5,description:"How many trials to run.",type:"integer"},show_trials_complete_scene:{default:!0,type:"boolean",description:"After the final trial, should a completion scene be shown? Otherwise, the game will immediately end."},instruction_type:{default:"long",description:"Type of instructions to show, 'short' or 'long'.",type:"string",enum:["short","long"]},instructions:{default:null,type:["object","null"],description:"When non-null, an InstructionsOptions object that will completely override the built-in instructions."},show_quit_button:{type:"boolean",default:!1,description:"Should the activity quit button be shown?"},show_fps:{type:"boolean",default:!1,description:"Should the FPS be shown?"},show_locale_picker:{type:"boolean",default:!1,description:"Should the icon that allows the participant to switch the locale be shown?"},seed:{type:["string","null"],default:null,description:"Optional seed for the seeded pseudo-random number generator. When null, the default Math.random() is used."},scoring:{type:"boolean",default:!1,description:"Should scoring data be generated? Default is false."}},t={activity_begin_iso8601_timestamp:{type:"string",format:"date-time",description:"ISO 8601 timestamp at the beginning of the game activity."},trial_begin_iso8601_timestamp:{type:["string","null"],format:"date-time",description:"ISO 8601 timestamp at the beginning of the trial. Null if trial was skipped."},trial_end_iso8601_timestamp:{type:["string","null"],format:"date-time",description:"ISO 8601 timestamp at the end of the trial (when user presses 'Done' after placing the dot). Null if trial was skipped."},trial_index:{type:["integer","null"],description:"Index of the trial within this assessment, 0-based."},square_side_length:{type:["number","null"],description:"Length of square side, in pixels. This is the square in which the dots are shown. Null if trial was skipped."},presented_dots:{description:"Configuration of dots presented to the user. Null if trial was skipped.",type:["array","null"],items:{type:"object",properties:{color_name:{type:"string",description:"Human-friendly name of color."},rgba_color:{type:"array",description:"Color as array, [r,g,b,a].",items:{type:"number"}},location:{type:"object",description:"Location of dot.",properties:{x:{type:"number",description:"X coordinate of dot."},y:{type:"number",description:"Y coordinate of dot."}}}}}},color_target_dot_index:{description:"Index (0-based) of presented dot whose color the user was asked to recall. Null if trial was skipped.",type:["integer","null"]},color_selected:{description:"Color selected by user. Null if trial was skipped.",type:["object","null"],properties:{color_name:{type:"string",description:"Human-friendly name of color."},rgba_color:{type:"array",description:"Color as array, [r,g,b,a].",items:{type:"number"}}}},color_selected_correct:{type:["boolean","null"],description:"Was the color selected by the user correct? Null if trial was skipped."},location_target_dot_index:{description:"Index (0-based) of presented dot whose location the user was asked to recall. Null if trial was skipped.",type:["integer","null"]},location_selected:{description:"Location selected by user. Null if trial was skipped.",type:["object","null"],properties:{x:{type:"number",description:"X coordinate of dot."},y:{type:"number",description:"Y coordinate of dot."}}},location_selected_delta:{type:["number","null"],description:"Euclidean distance between location target dot and the location selected by user. Null if trial was skipped."},color_selection_response_time_ms:{type:["number","null"],description:"Milliseconds from the beginning of color selection task until the user taps the done button. Null if trial was skipped."},location_selection_response_time_ms:{type:["number","null"],description:"Milliseconds from the beginning of location selection task until the user taps the done button. Null if trial was skipped."},quit_button_pressed:{type:"boolean",description:"Was the quit button pressed?"}},n={activity_begin_iso8601_timestamp:{type:"string",format:"date-time",description:"ISO 8601 timestamp at the beginning of the game activity."},first_trial_begin_iso8601_timestamp:{type:["string","null"],format:"date-time",description:"ISO 8601 timestamp at the beginning of the first trial. Null if no trials were completed."},last_trial_end_iso8601_timestamp:{type:["string","null"],format:"date-time",description:"ISO 8601 timestamp at the end of the last trial. Null if no trials were completed."},n_trials:{type:"integer",description:"Number of trials completed."},flag_trials_match_expected:{type:"integer",description:"Does the number of completed and expected trials match? 1 = true, 0 = false."},participant_score:{type:["number","null"],description:"Participant-facing score. It is a weighted score of color identification and location accuracy. This is a simple metric to provide feedback to the participant. Null if no trials attempted."}},i={name:"Color Dots",id:"color-dots",publishUuid:"72a1ef60-75c0-47b3-921c-aaee72cca9da",version:"0.8.32 (d289d12c)",moduleMetadata:{name:"@m2c2kit/assessment-color-dots",version:"0.8.32",dependencies:{"@m2c2kit/addons":"0.3.33","@m2c2kit/core":"0.3.34"}},translation:{configuration:{baseLocale:"en-US"},"en-US":{localeName:"English",INSTRUCTIONS_TITLE:"Color Dots",SHORT_INSTRUCTIONS_TEXT_PAGE_1:"For this activity, try to remember the location and color of 3 dots.",INSTRUCTIONS_TEXT_PAGE_1:"For this activity, try to remember the location and color of 3 dots.",INSTRUCTIONS_TEXT_PAGE_2:"Choose the color of the dot from the options at the bottom of the screen.",INSTRUCTIONS_TEXT_PAGE_3:"Next you are asked to place another dot. Touch the screen where you remember seeing the dot.",WHAT_COLOR:"What color was this dot?",WHERE_WAS:"Where was this dot?",TOUCH_TO_MOVE:"Touch the screen to move the dot",DONE_BUTTON_TEXT:"Done",START_BUTTON_TEXT:"START",NEXT_BUTTON_TEXT:"Next",BACK_BUTTON_TEXT:"Back",GET_READY_COUNTDOWN_TEXT:"GET READY!",TRIALS_COMPLETE_SCENE_TEXT:"This activity is complete.",TRIALS_COMPLETE_SCENE_BUTTON_TEXT:"OK"},"es-MX":{localeName:"Espa\xF1ol",INSTRUCTIONS_TITLE:"Puntos de Color",SHORT_INSTRUCTIONS_TEXT_PAGE_1:"Para esta actividad, intenta recordar la ubicaci\xF3n y el color de 3 puntos.",INSTRUCTIONS_TEXT_PAGE_1:"Para esta actividad, intenta recordar la ubicaci\xF3n y el color de 3 puntos.",INSTRUCTIONS_TEXT_PAGE_2:"Escoja el color del punto de las opciones en la parte de abajo de la pantalla.",INSTRUCTIONS_TEXT_PAGE_3:"Luego, se te pedir\xE1 que coloques otro punto. Toca la pantalla donde recuerdas haber visto el punto.",WHAT_COLOR:"\xBFDe qu\xE9 color era este punto?",WHERE_WAS:"\xBFD\xF3nde estaba este punto?",TOUCH_TO_MOVE:"Toca la pantalla para mover el punto",DONE_BUTTON_TEXT:"Listo",START_BUTTON_TEXT:"COMENZAR",NEXT_BUTTON_TEXT:"Siguiente",BACK_BUTTON_TEXT:"Atr\xE1s",GET_READY_COUNTDOWN_TEXT:"PREP\xC1RESE",TRIALS_COMPLETE_SCENE_TEXT:"Esta actividad est\xE1 completa.",TRIALS_COMPLETE_SCENE_BUTTON_TEXT:"OK"}},shortDescription:"Color Dots is cued-recall, item-location memory binding task, where after viewing 3 dots for a brief period of time, participants report: (1) the color at a cued location; (2) the location of a cued color.",longDescription:"Participants are asked to remember the location and color of three briefly presented, and uniquely colored dots. Each trial of this task requires two responses (subsequently referred to as stage 1 and stage 2 in the list of outcome variables): (1) reporting the color at a cued location; (2) reporting the location where a circular of a specified color previously appeared.",showFps:e.show_fps.default,width:400,height:800,bodyBackgroundColor:y.White,trialSchema:t,scoringSchema:n,parameters:e,fonts:[{fontName:"roboto",url:"fonts/roboto/Roboto-Regular.ttf"}],images:[{imageName:"cd1",height:450,width:350,url:"images/cd1.png"},{imageName:"cd2",height:450,width:350,url:"images/cd2.png",localize:!0},{imageName:"cd3",height:450,width:350,url:"images/cd3.png",localize:!0},{imageName:"circle-x",height:32,width:32,url:"images/circle-x.svg"}]};super(i)}async initialize(){await super.initialize();const e=this,t=e.getParameter("seed");typeof t=="string"&&U.setSeed(t);const n=350;if(e.getParameter("show_quit_button")){const c=new ge({imageName:"circle-x",position:{x:380,y:20},isUserInteractionEnabled:!0});e.addFreeNode(c),c.onTapDown(u=>{e.removeAllFreeNodes(),u.handled=!0;const h=new M;if(e.addScene(h),e.presentScene(h),e.addTrialData("quit_button_pressed",!0),e.trialComplete(),e.getParameter("scoring")){const p=e.calculateScores([],{numberOfTrials:e.getParameter("number_of_trials"),dotDiameter:e.getParameter("dot_diameter")});e.addScoringData(p),e.scoringComplete()}e.cancel()})}let r;e.getParameter("show_locale_picker")&&(r=new ye,e.addFreeNode(r));let i,o,s;const a=e.getParameter("instructions");if(a)s=ee.create(a);else switch(e.getParameter("instruction_type")){case"short":{s=ee.create({instructionScenes:[{title:"INSTRUCTIONS_TITLE",text:"SHORT_INSTRUCTIONS_TEXT_PAGE_1",imageName:"cd1",imageAboveText:!1,textFontSize:24,titleFontSize:30,textVerticalBias:.2,nextButtonText:"START_BUTTON_TEXT",nextButtonBackgroundColor:y.Green}]});break}case"long":{s=ee.create({instructionScenes:[{title:"INSTRUCTIONS_TITLE",text:"INSTRUCTIONS_TEXT_PAGE_1",imageName:"cd1",imageAboveText:!1,textFontSize:24,titleFontSize:30,textVerticalBias:.2,nextButtonText:"NEXT_BUTTON_TEXT",backButtonText:"BACK_BUTTON_TEXT"},{title:"INSTRUCTIONS_TITLE",text:"INSTRUCTIONS_TEXT_PAGE_2",imageName:"cd2",imageAboveText:!1,textFontSize:24,titleFontSize:30,textVerticalBias:.15,nextButtonText:"NEXT_BUTTON_TEXT",backButtonText:"BACK_BUTTON_TEXT"},{title:"INSTRUCTIONS_TITLE",text:"INSTRUCTIONS_TEXT_PAGE_3",imageName:"cd3",imageAboveText:!1,imageMarginTop:8,textFontSize:24,titleFontSize:30,textVerticalBias:.15,nextButtonText:"START_BUTTON_TEXT",nextButtonBackgroundColor:y.Green,backButtonText:"BACK_BUTTON_TEXT"}]});break}default:throw new Z("invalid value for instruction_type")}s[0].onAppear(()=>{e.addTrialData("activity_begin_iso8601_timestamp",this.beginIso8601Timestamp)}),e.addScenes(s);const l=new we({milliseconds:3e3,text:"GET_READY_COUNTDOWN_TEXT",zeroDwellMilliseconds:1e3,transition:se.none()});e.addScene(l);const d=[],m=e.getParameter("number_of_dots"),g=e.getParameter("dot_colors"),_=e.getParameter("dot_diameter"),z=g.length;function ae(c,u,h){for(let p=0;p<h.length;p++)if(Math.sqrt(Math.pow(c-h[p].x,2)+Math.pow(u-h[p].y,2))<_*3+.25*_)return!0;return!1}for(let c=0;c<e.getParameter("number_of_trials");c++){const u=JSON.parse(JSON.stringify(g)),h=new Array;for(let w=0;w<m;w++){let N,F;do N=U.singleFromRange(0+_/2+4,n-_/2-4),F=U.singleFromRange(0+_/2+4,n-_/2-4);while(ae(N,F,h));const he=U.singleFromRange(0,u.length-1),re=u.splice(he,1)[0],fe={x:N,y:F,rgbaColor:re.rgbaColor,colorName:re.colorName};h.push(fe)}const p=U.singleFromRange(0,h.length-1);d.push({colorSelectionDotIndex:p,locationSelectionDotIndex:NaN,dots:h})}const A=new M;e.addScene(A);const oe=new v({rect:{size:{width:n,height:n}},fillColor:y.Transparent,strokeColor:y.Gray,lineWidth:4,position:{x:200,y:300}});A.addChild(oe);const le=new j({text:"+",fontSize:32,fontColor:y.Black,localize:!1});oe.addChild(le),A.onSetup(()=>{A.run(O.sequence([O.wait({duration:e.getParameter("fixation_duration_ms")}),O.custom({callback:()=>{e.presentScene(P)}})]))}),A.onAppear(()=>{e.addTrialData("activity_begin_iso8601_timestamp",this.beginIso8601Timestamp),e.addTrialData("trial_begin_iso8601_timestamp",new Date().toISOString())});const P=new M;e.addScene(P);const q=new v({rect:{size:{width:n,height:n}},fillColor:y.Transparent,strokeColor:y.Gray,lineWidth:4,position:{x:200,y:300}});P.addChild(q);const W=new Array;P.onSetup(()=>{W.length=0;const c=d[e.trialIndex];for(const u of c.dots){const h={x:u.x,y:u.y,rgbaColor:u.rgbaColor,colorName:u.colorName,shape:new v({circleOfRadius:_/2,fillColor:u.rgbaColor,position:{x:u.x-n/2,y:u.y-n/2}})};W.push(h),q.addChild(h.shape)}P.run(O.sequence([O.wait({duration:e.getParameter("dot_present_duration_ms")}),O.custom({callback:()=>{q.removeAllChildren()}}),O.wait({duration:e.getParameter("dot_blank_duration_ms")}),O.custom({callback:()=>{e.presentScene(C)}})]))});const C=new M;e.addScene(C);const J=new v({rect:{size:{width:n,height:n}},fillColor:y.Transparent,strokeColor:y.Gray,lineWidth:4,position:{x:200,y:300}});C.addChild(J);const G=new j({text:"WHAT_COLOR",fontSize:24,position:{x:200,y:75}});C.addChild(G);const H=new v({position:{x:200,y:530},fillColor:y.Transparent,strokeColor:y.Black,lineWidth:2,rect:{width:350,height:60}});C.addChild(H);const B=new Se({position:{x:200,y:530},rows:1,columns:z,size:{width:350,height:60},backgroundColor:y.Transparent,gridLineColor:y.Transparent});C.addChild(B);let ne=-1;const D=new te({position:{x:200,y:650},text:"DONE_BUTTON_TEXT",hidden:!0});D.onTapDown(()=>{I.stop("colorRt"),ne=I.elapsed("colorRt"),I.remove("colorRt"),e.addTrialData("color_selection_response_time_ms",ne),G.hidden=!0,H.hidden=!0,B.hidden=!0,D.hidden=!0,D.run(O.sequence([O.wait({duration:e.getParameter("color_selected_hold_duration_ms")}),O.custom({callback:()=>{if(!o)throw new Z("no selected color");i={color_name:g.filter(p=>Q.rgbaColor(p.rgbaColor,o))[0].colorName,rgba_color:o},e.addTrialData("color_selected",i);const u=d[e.trialIndex],h=u.dots[u.colorSelectionDotIndex];e.addTrialData("color_selected_correct",Q.rgbaColor(h.rgbaColor,o)),e.presentScene(E)}})]))}),C.addChild(D),C.onSetup(()=>{G.hidden=!1,H.hidden=!1,B.hidden=!1,J.removeAllChildren();const u=d[e.trialIndex].colorSelectionDotIndex,h=W[u].shape.duplicate();h.fillColor=y.Transparent,h.strokeColor=y.Black,h.lineWidth=2,J.addChild(h),B.removeAllGridChildren();for(let p=0;p<z;p++){const w=new v({circleOfRadius:_/2,fillColor:g[p].rgbaColor,isUserInteractionEnabled:!0});w.size={width:_,height:_},w.onTapDown(()=>{h.fillColor=w.fillColor,D.hidden=!1,D.isUserInteractionEnabled=!0,o=w.fillColor}),B.addAtCell(w,0,p)}}),C.onAppear(()=>{I.startNew("colorRt")});const E=new M({isUserInteractionEnabled:!0});e.addScene(E);const k=new v({rect:{size:{width:n,height:n}},fillColor:y.Transparent,strokeColor:y.Gray,lineWidth:4,position:{x:200,y:300}});E.addChild(k),k.onPointerDown(()=>{X=!1});const ce=new j({text:"WHERE_WAS",fontSize:24,position:{x:165,y:75},preferredMaxLayoutWidth:285,horizontalAlignmentMode:_e.Left});E.addChild(ce);const de=new j({text:"TOUCH_TO_MOVE",fontSize:24,position:{x:200,y:530}});E.addChild(de);let S,$;function K(c){const u=Y(c);return!(u.x<_/2||u.x+_/2>n||u.y<_/2||u.y+_/2>n)}function ue(c){const u=Y(c);return!(u.x<0||u.x>n||u.y<0||u.y>n)}function Y(c){const u=k.position.x-n/2,h=k.position.y-n/2,p=c.x-u,w=c.y-h;return{x:p,y:w}}let X=!1;E.onPointerUp(c=>{X||ue(c.point)&&(S.position={x:c.point.x,y:c.point.y},K(S.position)?x.hidden=!1:x.hidden=!0)}),E.onSetup(()=>{const c=d[e.trialIndex],u=c.colorSelectionDotIndex;x.hidden=!0,k.removeAllChildren();const h=new v({circleOfRadius:_/2,fillColor:o,strokeColor:y.Black,lineWidth:2,position:{x:c.dots[u].x-n/2,y:c.dots[u].y-n/2}});k.addChild(h);let p=-1;do p=U.singleFromRange(0,m-1),Q.rgbaColor(c.dots[p].rgbaColor,o)&&(p=-1),p===u&&(p=-1);while(p===-1);c.locationSelectionDotIndex=p,S=new v({circleOfRadius:_/2,fillColor:c.dots[p].rgbaColor,position:{x:345,y:75},isUserInteractionEnabled:!0,draggable:!0}),E.addChild(S),$={x:c.dots[p].x,y:c.dots[p].y,color_name:c.dots[p].colorName,color_rgba:c.dots[p].rgbaColor};const w=[];for(let N=0;N<c.dots.length;N++){const F={color_name:c.dots[N].colorName,rgba_color:c.dots[N].rgbaColor,location:{x:c.dots[N].x,y:c.dots[N].y}};w.push(F)}if(e.addTrialData("presented_dots",w),e.addTrialData("color_target_dot_index",c.colorSelectionDotIndex),e.addTrialData("location_target_dot_index",c.locationSelectionDotIndex),!o)throw new Z("no selected color!");h.fillColor=o,S.onTapDown(N=>{N.handled=!0}),S.onDragStart(()=>{X=!0}),S.onDrag(()=>{K(S.position)?x.hidden=!1:x.hidden=!0}),S.onDragEnd(()=>{X=!1,K(S.position)?x.hidden=!1:x.hidden=!0})}),E.onAppear(()=>{I.startNew("locationRt")});let ie=-1;const x=new te({position:{x:200,y:650},text:"DONE_BUTTON_TEXT",hidden:!0,isUserInteractionEnabled:!0});x.onTapDown(()=>{I.stop("locationRt"),ie=I.elapsed("locationRt"),I.remove("locationRt"),e.addTrialData("location_selection_response_time_ms",ie),e.addTrialData("trial_end_iso8601_timestamp",new Date().toISOString()),E.removeChild(S);const c=Y(S.position);e.addTrialData("location_selected",c),e.addTrialData("square_side_length",n);const u=Math.sqrt(Math.pow(c.x-$.x,2)+Math.pow(c.y-$.y,2));if(e.addTrialData("location_selected_delta",u),e.addTrialData("quit_button_pressed",!1),e.addTrialData("trial_index",e.trialIndex),e.trialComplete(),e.trialIndex<e.getParameter("number_of_trials"))e.presentScene(A);else{if(e.getParameter("scoring")){const h=e.calculateScores(e.data.trials,{numberOfTrials:e.getParameter("number_of_trials"),dotDiameter:e.getParameter("dot_diameter")});e.addScoringData(h),e.scoringComplete()}e.getParameter("show_trials_complete_scene")?e.presentScene(R,se.slide({direction:be.Left,duration:500,easing:Te.sinusoidalInOut})):e.end()}}),E.addChild(x);const R=new M;e.addScene(R);const pe=new j({text:"TRIALS_COMPLETE_SCENE_TEXT",position:{x:200,y:400}});R.addChild(pe);const V=new te({text:"TRIALS_COMPLETE_SCENE_BUTTON_TEXT",position:{x:200,y:650}});V.isUserInteractionEnabled=!0,V.onTapDown(()=>{V.isUserInteractionEnabled=!1,R.removeAllChildren(),e.end()}),R.addChild(V),R.onSetup(()=>{e.removeAllFreeNodes()})}calculateScores(e,t){const n=(o,s,a)=>[{x:a,y:a},{x:o-a,y:a},{x:a,y:o-a},{x:o-a,y:o-a}].reduce((d,m)=>{const g=s.x-m.x,_=s.y-m.y,z=Math.sqrt(g*g+_*_);return Math.max(d,z)},0),r=new T(e);return r.mutate({trial_score:o=>{const s=n(o.square_side_length,o.presented_dots[o.location_target_dot_index].location,t.dotDiameter/2);return((o.color_selected_correct?.5:0)+(s-o.location_selected_delta)/s*.5)/t.numberOfTrials*100}}).summarize({activity_begin_iso8601_timestamp:this.beginIso8601Timestamp,first_trial_begin_iso8601_timestamp:r.arrange("trial_begin_iso8601_timestamp").slice(0).pull("trial_begin_iso8601_timestamp"),last_trial_end_iso8601_timestamp:r.arrange("-trial_end_iso8601_timestamp").slice(0).pull("trial_end_iso8601_timestamp"),n_trials:r.length,flag_trials_match_expected:r.length===t.numberOfTrials?1:0,participant_score:ve("trial_score")}).observations}}export{Ie as ColorDots};
