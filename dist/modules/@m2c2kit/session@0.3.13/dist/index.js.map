{"version":3,"file":"index.js","sources":["../src/DomHelper.ts","../src/SessionEvent.ts","../src/m2c2kitCss.ts","../src/HtmlDialog.ts","../src/DiagnosticsReporter.ts","../src/Session.ts","../src/index.ts"],"sourcesContent":["import { Activity, ActivityType, M2Error } from \"@m2c2kit/core\";\n\nexport class DomHelper {\n  /**\n   * Specifies the HTML element in which to render the m2c2kit activities.\n   *\n   * @param rootElement - the element to add the survey div and canvas div to\n   */\n  static createRoot(rootElement: HTMLElement): void {\n    const surveyDiv = document.createElement(\"div\");\n    surveyDiv.setAttribute(\"id\", \"m2c2kit-survey-div\");\n    rootElement.appendChild(surveyDiv);\n\n    const canvasDiv = document.createElement(\"div\");\n    canvasDiv.setAttribute(\"id\", \"m2c2kit-canvas-div\");\n    canvasDiv.className = \"m2c2kit-full-viewport m2c2kit-flex-container\";\n\n    const canvas = document.createElement(\"canvas\");\n    canvas.setAttribute(\"id\", \"m2c2kit-canvas\");\n    canvas.className = \"m2c2kit-full-viewport\";\n    canvasDiv.appendChild(canvas);\n\n    rootElement.appendChild(canvasDiv);\n  }\n\n  /**\n   * Adds a style sheet to the head of the document.\n   *\n   * @param css - text of the CSS\n   */\n  static addStyleSheet(css: string): void {\n    const styleSheet = document.createElement(\"style\");\n    styleSheet.innerText = css;\n    document.head.appendChild(styleSheet);\n  }\n\n  /**\n   * Add elements to hide the canvas and show a spinner.\n   */\n  static addLoadingElements(): void {\n    const canvasDiv = document.getElementById(\"m2c2kit-canvas-div\");\n    if (!canvasDiv) {\n      throw new M2Error(\"Could not find container element\");\n    }\n\n    let overlayDiv = document.getElementById(\"m2c2kit-canvas-overlay-div\");\n    if (!overlayDiv) {\n      overlayDiv = document.createElement(\"div\");\n      overlayDiv.setAttribute(\"id\", \"m2c2kit-canvas-overlay-div\");\n      overlayDiv.className = \"m2c2kit-canvas-overlay m2c2kit-display-none\";\n\n      const spinnerDiv = document.createElement(\"div\");\n      spinnerDiv.setAttribute(\"id\", \"m2c2kit-spinner-div\");\n      spinnerDiv.className = \"m2c2kit-spinner m2c2kit-display-none\";\n\n      canvasDiv.appendChild(overlayDiv);\n      canvasDiv.appendChild(spinnerDiv);\n    }\n  }\n\n  /**\n   * Depending on the type of activity, set the visibility of the survey div\n   * and canvas div.\n   *\n   * @param activity - the activity to configure the DOM for\n   */\n  static configureDomForActivity(activity: Activity): void {\n    if (activity.type == ActivityType.Game) {\n      this.setCanvasDivVisibility(true);\n      this.setSurveyDivVisibility(false);\n    }\n    if (activity.type == ActivityType.Survey) {\n      this.setCanvasDivVisibility(false);\n      this.setSurveyDivVisibility(true);\n      DomHelper.setBusyAnimationVisibility(false);\n      DomHelper.setCanvasOverlayVisibility(false);\n    }\n  }\n\n  /**\n   * Hide the canvas div and survey div.\n   */\n  static hideM2c2Elements(): void {\n    this.setCanvasDivVisibility(false);\n    this.setSurveyDivVisibility(false);\n  }\n\n  /**\n   * Shows or hides the canvas overlay.\n   *\n   * @param visible - true if the canvas overlay should be visible\n   */\n  static setCanvasOverlayVisibility(visible: boolean): void {\n    const div = document.getElementById(\"m2c2kit-canvas-overlay-div\");\n    if (div) {\n      if (visible) {\n        div.classList.remove(\"m2c2kit-display-none\");\n      } else {\n        div.classList.add(\"m2c2kit-display-none\");\n      }\n    }\n  }\n\n  /**\n   * Shows or hides the busy animation.\n   *\n   * @param visible - true if the busy animation should be visible\n   */\n  static setBusyAnimationVisibility(visible: boolean): void {\n    const div = document.getElementById(\"m2c2kit-spinner-div\");\n    if (div) {\n      if (visible) {\n        div.classList.remove(\"m2c2kit-display-none\");\n      } else {\n        div.classList.add(\"m2c2kit-display-none\");\n      }\n    }\n  }\n\n  /**\n   * Shows or hides the survey div.\n   *\n   * @param visible - true if the survey div should be visible\n   */\n  private static setSurveyDivVisibility(visible: boolean): void {\n    const surveyDiv = document.getElementById(\"m2c2kit-survey-div\");\n    if (surveyDiv && visible) {\n      surveyDiv.classList.remove(\"m2c2kit-display-none\");\n      surveyDiv.classList.add(\"m2c2kit-display-block\");\n    }\n    if (surveyDiv && !visible) {\n      surveyDiv.classList.add(\"m2c2kit-display-none\");\n      surveyDiv.classList.remove(\"m2c2kit-display-block\");\n    }\n  }\n\n  /**\n   * Shows or hides the canvas div.\n   *\n   * @param visible - true if the canvas div should be visible\n   */\n  private static setCanvasDivVisibility(visible: boolean): void {\n    const canvasDiv = document.getElementById(\"m2c2kit-canvas-div\");\n    if (canvasDiv && visible) {\n      canvasDiv.classList.remove(\"m2c2kit-display-none\");\n      canvasDiv.classList.add(\"m2c2kit-flex-container\");\n    }\n    if (canvasDiv && !visible) {\n      canvasDiv.classList.add(\"m2c2kit-display-none\");\n      canvasDiv.classList.remove(\"m2c2kit-flex-container\");\n    }\n  }\n}\n","import { M2Event } from \"@m2c2kit/core\";\nimport { Session } from \"./Session\";\n\n/** Base interface for all Session events. */\nexport interface SessionEvent extends M2Event<Session> {\n  target: Session;\n}\n\nexport const SessionEventType = {\n  SessionInitialize: \"SessionInitialize\",\n  SessionStart: \"SessionStart\",\n  SessionEnd: \"SessionEnd\",\n  SessionData: \"SessionData\",\n} as const;\n\nexport type SessionEventType =\n  (typeof SessionEventType)[keyof typeof SessionEventType];\n","export const m2c2kitCss = `.m2c2kit-background-color {\n  background: white;\n}\n\n.m2c2kit-no-margin {\n  margin: 0;\n}\n\n.m2c2kit-display-none {\n  display: none;\n}\n\n.m2c2kit-display-block {\n  display: block;\n}\n\n.m2c2kit-full-viewport {\n  height: 100vh;\n  width: 100vw;\n}\n\n.m2c2kit-flex-container {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.m2c2kit-canvas-overlay {\n  background-color: white;\n  width: 100vw;\n  height: 100vh;\n  position: absolute\n}\n\n.m2c2kit-spinner {\n  border: 16px solid #f3f3f3;\n  border-radius: 50%;\n  border-top: 16px solid #212529;\n  width: 120px;\n  height: 120px;\n  /* Safari */\n  -webkit-animation: m2c2kit-loader-spin 1.5s linear infinite;\n  animation: m2c2kit-loader-spin 1.5s linear infinite;\n  position: absolute;\n}\n\n#m2c2kit-time-stepping-div {\n  position: fixed;\n  top: 4px;\n  left: 4px\n}\n\n/* Safari */\n@-webkit-keyframes m2c2kit-loader-spin {\n  0% {\n    -webkit-transform: rotate(0deg);\n  }\n\n  100% {\n    -webkit-transform: rotate(360deg);\n  }\n}\n\n@keyframes m2c2kit-loader-spin {\n  0% {\n    transform: rotate(0deg);\n  }\n\n  100% {\n    transform: rotate(360deg);\n  }\n}`;\n","import { HtmlDialogOptions } from \"./HtmlDialogOptions\";\n\nexport class HtmlDialog {\n  private overlay: HTMLDivElement;\n  private dialog: HTMLDivElement;\n  private message: HTMLParagraphElement;\n  private button: HTMLButtonElement;\n  private onDialogConfirm?: () => void;\n  private removeOverlayAfterConfirm;\n  private static activeDialog: HtmlDialog | null = null;\n\n  /**\n   * HtmlDialog class creates a custom dialog box.\n   *\n   * @remarks The dialog box is centered on the screen and has an overlay\n   * background composed of a large character (e.g., an emoji). The dialog box\n   * is shown using HTML and CSS, not drawing on a canvas, so that it will\n   * reliably be shown even if there is an error in the assessment code.\n   *\n   * @param options - Options for the dialog box.\n   */\n  constructor(options: HtmlDialogOptions) {\n    this.onDialogConfirm = options.onDialogConfirm;\n    this.removeOverlayAfterConfirm = options.removeOverlayAfterConfirm ?? true;\n\n    // overlay background\n    this.overlay = document.createElement(\"div\");\n    this.overlay.style.position = \"fixed\";\n    this.overlay.style.top = \"0\";\n    this.overlay.style.left = \"0\";\n    this.overlay.style.width = \"100vw\";\n    this.overlay.style.height = \"100vh\";\n    this.overlay.style.backgroundColor = \"#fff\";\n    this.overlay.style.display = \"flex\";\n    this.overlay.style.justifyContent = \"center\";\n    this.overlay.style.alignItems = \"center\";\n    this.overlay.style.zIndex = \"1000\";\n\n    // character background element\n    const background = document.createElement(\"div\");\n    background.textContent = options.backgroundCharacter ?? null;\n    background.style.position = \"absolute\";\n    background.style.fontSize = \"20rem\"; // Very large\n    background.style.opacity = \"0.40\"; // Subtle appearance\n    background.style.top = \"50%\";\n    background.style.left = \"50%\";\n    background.style.transform = \"translate(-50%, -50%)\";\n\n    // dialog box\n    this.dialog = document.createElement(\"div\");\n    this.dialog.style.backgroundColor = \"#fff\";\n    this.dialog.style.padding = \"20px\";\n    this.dialog.style.borderRadius = \"10px\";\n    this.dialog.style.boxShadow = \"0px 4px 10px rgba(0, 0, 0, 0.3)\";\n    this.dialog.style.textAlign = \"center\";\n    this.dialog.style.minWidth = \"200px\";\n    this.dialog.style.maxWidth = \"75%\";\n    this.dialog.style.opacity = \".80\";\n    this.dialog.style.position = \"relative\"; // Add this to ensure it's above the emoji\n    this.dialog.style.zIndex = \"1001\"; // Higher than the overlay\n\n    this.message = document.createElement(\"p\");\n    this.message.textContent = options.message;\n    this.message.style.marginBottom = \"15px\";\n    this.message.style.fontFamily = \"Arial, sans-serif\";\n\n    this.button = document.createElement(\"button\");\n    this.button.textContent = \"OK\";\n    this.button.style.padding = \"8px 15px\";\n    this.button.style.border = \"none\";\n    this.button.style.backgroundColor = \"#007bff\";\n    this.button.style.color = \"#fff\";\n    this.button.style.borderRadius = \"5px\";\n    this.button.style.cursor = \"pointer\";\n    this.button.style.fontSize = \"16px\";\n    this.button.style.fontFamily = \"Arial, sans-serif\";\n    this.button.onclick = this.close.bind(this);\n\n    this.dialog.appendChild(this.message);\n    this.dialog.appendChild(this.button);\n    this.overlay.appendChild(background);\n    this.overlay.appendChild(this.dialog);\n  }\n\n  /**\n   * Shows the dialog box. If another dialog is already visible,\n   * it will be closed before showing this one.\n   */\n  public show(): void {\n    // Close any existing dialog first\n    if (HtmlDialog.activeDialog && HtmlDialog.activeDialog !== this) {\n      HtmlDialog.activeDialog.forceClose();\n    }\n\n    HtmlDialog.activeDialog = this;\n    document.body.appendChild(this.overlay);\n  }\n\n  /**\n   * Checks if any dialog is currently being displayed\n   *\n   * @returns True if a dialog is currently visible\n   */\n  public static isDialogVisible(): boolean {\n    return HtmlDialog.activeDialog !== null;\n  }\n\n  /**\n   * Closes the dialog without triggering onDialogConfirm callback\n   */\n  private forceClose(): void {\n    // Remove only the dialog box, keeping the overlay with emoji\n    if (this.dialog.parentNode === this.overlay) {\n      this.overlay.removeChild(this.dialog);\n      if (this.removeOverlayAfterConfirm) {\n        this.overlay.remove();\n      }\n    }\n    this.button.onclick = null;\n    HtmlDialog.activeDialog = null;\n  }\n\n  /**\n   * Closes the dialog and calls the onDialogConfirm callback if provided\n   */\n  private close(): void {\n    // Remove only the dialog box, keeping the overlay with emoji\n    if (this.dialog.parentNode === this.overlay) {\n      this.overlay.removeChild(this.dialog);\n      if (this.removeOverlayAfterConfirm) {\n        this.overlay.remove();\n      }\n    }\n    this.button.onclick = null;\n    HtmlDialog.activeDialog = null;\n    if (this.onDialogConfirm) {\n      this.onDialogConfirm();\n    }\n  }\n}\n","import {\n  M2c2KitHelpers,\n  Uuid,\n  ActivityType,\n  Game,\n  Activity,\n} from \"@m2c2kit/core\";\nimport { SessionKeyValueData } from \"./SessionData\";\nimport { SessionEvent, SessionEventType } from \"./SessionEvent\";\nimport { SessionDataEvent } from \"./SessionDataEvent\";\nimport { HtmlDialog } from \"./HtmlDialog\";\nimport { DiagnosticsReporterOptions } from \"./DiagnosticsReporterOptions\";\n\nconst MAX_DIAGNOSTIC_EVENTS = 10;\n\nexport class DiagnosticsReporter {\n  private staticDiagnosticData: SessionKeyValueData = {};\n  private batteryStatus: BatteryStatus | undefined;\n  private storageEstimate: StorageEstimate | undefined;\n  private isHandlingException = false;\n  private reportedExceptions = new Set<string>();\n  private diagnosticEventsCount = 0;\n  private getSessionUuid: () => string;\n  private getCurrentActivity: () => Activity | undefined;\n  private dispatchEvent: (event: SessionEvent, extra?: unknown) => void;\n  private onErrorDialogConfirm: () => void;\n  private removeOverlayAfterErrorDialogConfirm: boolean;\n  private onlyM2Errors: boolean;\n  private handleResourceLoadingErrors: boolean;\n  private maximumDiagnosticEvents: number;\n  private errorHandler: (event: ErrorEvent) => void;\n  private rejectionHandler: (event: PromiseRejectionEvent) => void;\n  private resourceErrorHandler: (event: Event) => void;\n\n  constructor(options: DiagnosticsReporterOptions) {\n    this.getSessionUuid = options.getSessionUuid;\n    this.getCurrentActivity = options.getCurrentActivity;\n    this.dispatchEvent = options.dispatchEvent;\n    this.onErrorDialogConfirm = options.onErrorDialogConfirm || (() => {});\n    this.removeOverlayAfterErrorDialogConfirm =\n      options.removeOverlayAfterErrorDialogConfirm ?? false;\n    this.onlyM2Errors = options.onlyM2Errors ?? true;\n    this.handleResourceLoadingErrors =\n      options.handleResourceLoadingErrors ?? false;\n    this.maximumDiagnosticEvents =\n      options.maximumDiagnosticEvents ?? MAX_DIAGNOSTIC_EVENTS;\n    this.errorHandler = this.handleError.bind(this);\n    this.rejectionHandler = this.handleRejection.bind(this);\n    this.resourceErrorHandler = this.handleResourceError.bind(this);\n\n    this.refreshBatteryStatus();\n    this.refreshStorageEstimate();\n  }\n\n  /**\n   * Sets the value of a variable that will be the same for all diagnostic data.\n   *\n   * @param key - key (variable name) for the static diagnostic data\n   * @param value - value for the data\n   */\n  addStaticDiagnosticData(\n    key: string,\n    value: string | number | boolean | object | undefined | null,\n  ): void {\n    this.staticDiagnosticData[key] = value;\n  }\n\n  /**\n   * Starts the DiagnosticsReporter by setting up global error handlers to\n   * capture uncaught errors, unhandled promise rejections, and possibly\n   * resource loading errors to be reported through diagnostics.\n   */\n  start(): void {\n    window.addEventListener(\"error\", this.errorHandler);\n    window.addEventListener(\"unhandledrejection\", this.rejectionHandler);\n    if (this.handleResourceLoadingErrors) {\n      document.addEventListener(\"error\", this.resourceErrorHandler, true);\n    }\n  }\n\n  /**\n   * Stops the DiagnosticsReporter by removing all global error handlers\n   * to prevent memory leaks. Call this method when the DiagnosticsReporter\n   * is no longer needed.\n   */\n  stop(): void {\n    window.removeEventListener(\"error\", this.errorHandler);\n    window.removeEventListener(\"unhandledrejection\", this.rejectionHandler);\n    document.removeEventListener(\"error\", this.resourceErrorHandler, true);\n  }\n\n  /**\n   * Handles synchronous errors\n   */\n  private handleError(event: ErrorEvent): boolean {\n    if (this.onlyM2Errors && event.error && event.error.name !== \"M2Error\") {\n      return false;\n    }\n\n    this.handleException(event.error || new Error(event.message), {\n      source: event.filename,\n      lineno: event.lineno,\n      colno: event.colno,\n      type: \"synchronous\",\n    });\n    return false; // Don't prevent default handling\n  }\n\n  /**\n   * Handles unhandled promise rejections\n   */\n  private handleRejection(event: PromiseRejectionEvent): boolean {\n    let error: Error;\n    if (event.reason instanceof Error) {\n      error = event.reason;\n    } else if (typeof event.reason === \"string\") {\n      error = new Error(event.reason);\n    } else {\n      try {\n        error = new Error(JSON.stringify(event.reason));\n      } catch {\n        error = new Error(\n          \"Unhandled Promise rejection with unserializable reason\",\n        );\n      }\n    }\n\n    if (this.onlyM2Errors && error && error.name !== \"M2Error\") {\n      return false;\n    }\n\n    // Extract line/column info from stack trace\n    const errorInfo = this.extractErrorLocationFromStack(error.stack);\n\n    this.handleException(error, {\n      source: errorInfo.source || \"promise_rejection\",\n      lineno: errorInfo.lineno,\n      colno: errorInfo.colno,\n      type: \"promise_rejection\",\n    });\n\n    return false; // Don't prevent default handling\n  }\n\n  /**\n   * Extracts source file, line number and column number from error stack trace\n   * Works across Chrome, Firefox, Safari, Edge on both desktop and mobile\n   *\n   * @param stack - The error stack trace string\n   * @returns Object containing source file, line number, and column number\n   * @private\n   */\n  private extractErrorLocationFromStack(stack?: string): {\n    source?: string;\n    lineno?: number;\n    colno?: number;\n  } {\n    if (!stack) return {};\n\n    const MAX_STACK_LINES = 20; // Don't process extremely large stacks\n    const stackLines = stack.split(\"\\n\").slice(0, MAX_STACK_LINES);\n\n    for (let i = 0; i < stackLines.length; i++) {\n      const line = stackLines[i].trim();\n\n      // Skip empty lines\n      if (!line) continue;\n\n      // Chrome/Edge format: \"at methodName (file:///path/file.js:line:column)\"\n      const chromeMatch = line.match(/at .*? \\(([^)]+):(\\d+):(\\d+)\\)/);\n      if (chromeMatch) {\n        return {\n          source: chromeMatch[1],\n          lineno: parseInt(chromeMatch[2], 10),\n          colno: parseInt(chromeMatch[3], 10),\n        };\n      }\n\n      // Chrome/Edge alternative format: \"at file:///path/file.js:line:column\"\n      const chromeAltMatch = line.match(/at ([^ ]+):(\\d+):(\\d+)/);\n      if (chromeAltMatch) {\n        return {\n          source: chromeAltMatch[1],\n          lineno: parseInt(chromeAltMatch[2], 10),\n          colno: parseInt(chromeAltMatch[3], 10),\n        };\n      }\n\n      // Firefox/Safari format: \"functionName@file:///path/file.js:line:column\"\n      // or \"@file:///path/file.js:line:column\"\n      const mozillaMatch = line.match(/(?:@|at )([^@]+):(\\d+):(\\d+)/);\n      if (mozillaMatch) {\n        return {\n          source: mozillaMatch[1],\n          lineno: parseInt(mozillaMatch[2], 10),\n          colno: parseInt(mozillaMatch[3], 10),\n        };\n      }\n\n      // Handle eval call stacks in Safari/Firefox\n      // Example: \"methodName@http://site.com/file.js line 1 > eval line 1 > eval:1:1\"\n      const evalMatch = line.match(/([^@\\s]+)(?:.*?)?:(\\d+):(\\d+)$/);\n      if (evalMatch) {\n        return {\n          source: evalMatch[1],\n          lineno: parseInt(evalMatch[2], 10),\n          colno: parseInt(evalMatch[3], 10),\n        };\n      }\n\n      // Generic fallback pattern that looks for file:line:column\n      // This helps with other browser formats we might not specifically handle\n      const genericMatch = line.match(/([^:]+):(\\d+):(\\d+)/);\n      if (genericMatch) {\n        return {\n          source: genericMatch[1],\n          lineno: parseInt(genericMatch[2], 10),\n          colno: parseInt(genericMatch[3], 10),\n        };\n      }\n    }\n\n    return {}; // No location information found\n  }\n\n  /**\n   * Handles resource loading errors\n   */\n  private handleResourceError(event: Event): void {\n    // There are many HTML elements that can cause resource loading errors,\n    // but for now watch only images and scripts.\n    if (\n      event.target instanceof HTMLImageElement ||\n      event.target instanceof HTMLScriptElement\n    ) {\n      let url = \"src\" in event.target ? event.target.src : \"unknown\";\n      url = this.truncateString(url, 100);\n      this.handleException(\n        new Error(\n          `Error on element ${event.target.nodeName} in document at ${document.URL}. Failed to load resource: ${url}`,\n        ),\n        {\n          source: \"resource_loading\",\n          type: \"resource_loading\",\n        },\n      );\n    }\n  }\n\n  /**\n   * Handles uncaught exceptions and sends diagnostic data to listeners.\n   *\n   * @remarks This method is called by the global error handler and\n   * unhandled promise rejection handler.\n   *\n   * @param error - the error object\n   * @param errorInfo - additional information about the error\n   * @param errorInfo.source - the source of the error (e.g., filename)\n   * @param errorInfo.lineno - the line number where the error occurred\n   * @param errorInfo.colno - the column number where the error occurred   *\n   */\n  private handleException(error: Error, errorInfo?: ErrorInfo): void {\n    if (this.isHandlingException) {\n      console.error(\"Error occurred while handling another exception\", error);\n      return;\n    }\n\n    const errorKey = `${error.message}:${errorInfo?.lineno || 0}:${errorInfo?.colno || 0}`;\n    if (this.reportedExceptions.has(errorKey)) {\n      return;\n    }\n    this.reportedExceptions.add(errorKey);\n    this.diagnosticEventsCount++;\n\n    if (this.diagnosticEventsCount > this.maximumDiagnosticEvents) {\n      console.warn(\n        `Maximum diagnostic events reached (${this.maximumDiagnosticEvents}). No more will be reported.`,\n      );\n      return;\n    }\n\n    try {\n      this.isHandlingException = true;\n\n      // Only show a dialog if there isn't one already visible\n      if (!HtmlDialog.isDialogVisible()) {\n        const dialog = new HtmlDialog({\n          message:\n            \"We are sorry, but something went wrong. Please try again later.\",\n          backgroundCharacter: \"âš ï¸\",\n          onDialogConfirm: this.onErrorDialogConfirm,\n          removeOverlayAfterConfirm: this.removeOverlayAfterErrorDialogConfirm,\n        });\n        dialog.show();\n      } else {\n        console.log(\"Error dialog already visible, not showing another one\");\n      }\n\n      // Create diagnostic data and dispatch event\n      const currentActivity = this.getCurrentActivity();\n      const { timestamp, iso8601Timestamp } = M2c2KitHelpers.createTimestamps();\n      const diagnosticData: SessionKeyValueData = {\n        data_type: \"diagnostics\",\n        document_uuid: Uuid.generate(),\n        iso8601_timestamp: iso8601Timestamp,\n        session_uuid: this.getSessionUuid(),\n        activity: {\n          id: currentActivity?.id ?? null,\n          uuid: currentActivity?.uuid ?? null,\n          publish_uuid: currentActivity?.publishUuid ?? null,\n          version:\n            currentActivity?.type === ActivityType.Game\n              ? (currentActivity as Game).options.version\n              : null,\n          begin_iso8601_timestamp:\n            currentActivity?.type === ActivityType.Game\n              ? (currentActivity as Game).beginIso8601Timestamp\n              : null,\n          locale:\n            currentActivity?.type === ActivityType.Game\n              ? ((currentActivity as Game).i18n?.locale ?? null)\n              : null,\n        },\n        error_message: error.message,\n        error_stack: this.truncateString(error.stack, 2048) ?? null,\n        error_source: errorInfo?.source ?? null,\n        error_line: errorInfo?.lineno || 0,\n        error_column: errorInfo?.colno || 0,\n        error_type: errorInfo?.type ?? null,\n        device_metadata: this.getExtendedDeviceMetadata(),\n        ...this.staticDiagnosticData,\n      };\n\n      const sessionDataEvent: SessionDataEvent = {\n        // target will be replaced by the Session instance in the eventRaiser,\n        // which is raiseEventOnListeners() in the Session class. It will set\n        // the target to the session instance.\n        target: null as unknown as SessionEvent[\"target\"],\n        type: SessionEventType.SessionData,\n        data: diagnosticData,\n        dataType: \"Diagnostics\",\n        timestamp: timestamp,\n        iso8601Timestamp: iso8601Timestamp,\n      };\n\n      this.dispatchEvent(sessionDataEvent);\n      console.log(\"âŒ diagnostics:\", error, errorInfo);\n    } finally {\n      this.isHandlingException = false;\n    }\n  }\n\n  private getExtendedDeviceMetadata() {\n    try {\n      const screen = window.screen || {};\n      let orientation = undefined;\n      try {\n        orientation = screen.orientation || undefined;\n      } catch {\n        // Ignore errors accessing orientation\n      }\n\n      return {\n        userAgent: navigator?.userAgent,\n        language: navigator?.language,\n        hardwareConcurrency: navigator?.hardwareConcurrency,\n        deviceMemory:\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n          typeof (navigator as any)?.deviceMemory !== \"undefined\"\n            ? // eslint-disable-next-line @typescript-eslint/no-explicit-any\n              (navigator as any).deviceMemory\n            : undefined,\n        // Connection API is experimental. Wrap in try/catch to avoid errors\n        // that some browsers may throw if the API is not available.\n        connection: (() => {\n          try {\n            // eslint-disable-next-line @typescript-eslint/no-explicit-any\n            const conn = (navigator as any)?.connection;\n            return conn\n              ? {\n                  effectiveType: conn?.effectiveType,\n                  downlink: conn?.downlink,\n                  downlinkMax: conn?.downlinkMax,\n                  rtt: conn?.rtt,\n                  saveData: conn?.saveData,\n                  type: conn?.type,\n                }\n              : undefined;\n          } catch {\n            return undefined;\n          }\n        })(),\n        battery: this.batteryStatus,\n        storage: this.storageEstimate,\n        cookieEnabled: navigator?.cookieEnabled,\n        webAssembly: typeof WebAssembly !== \"undefined\",\n        maxTouchPoints: navigator?.maxTouchPoints,\n        devicePixelRatio: window?.devicePixelRatio,\n        screen: {\n          availHeight: screen?.availHeight,\n          availWidth: screen?.availWidth,\n          colorDepth: screen?.colorDepth,\n          height: screen?.height,\n          orientation: orientation\n            ? {\n                type: orientation?.type,\n                angle: orientation?.angle,\n              }\n            : undefined,\n          pixelDepth: screen?.pixelDepth,\n          width: screen?.width,\n        },\n        device_timezone:\n          Intl?.DateTimeFormat()?.resolvedOptions()?.timeZone || \"\",\n        device_timezone_offset_minutes: new Date().getTimezoneOffset(),\n      };\n    } catch (error) {\n      console.warn(\"Error collecting device metadata:\", error);\n      // Return minimal metadata to avoid breaking diagnostics completely\n      return {\n        userAgent: navigator?.userAgent || \"unknown\",\n      };\n    }\n  }\n\n  /**\n   * Refreshes the battery status.\n   *\n   * @remarks This method uses the Battery Status API to get the current\n   * battery status of the device. Because the API is asynchronous, we\n   * call it previously so that it is ready when we need it and do not need\n   * to await it.\n   */\n  private refreshBatteryStatus(): void {\n    try {\n      // Check if API exists\n      if (!(\"getBattery\" in navigator)) {\n        return;\n      }\n\n      // Set a timeout to prevent hanging\n      const timeoutPromise = new Promise<null>((_, reject) => {\n        setTimeout(() => reject(new Error(\"Battery status timeout\")), 2000);\n      });\n\n      // Race with actual battery fetch\n      Promise.race([\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (navigator as any).getBattery(),\n        timeoutPromise,\n      ])\n        .then((battery: BatteryStatus) => {\n          this.batteryStatus = {\n            charging: battery?.charging,\n            level: battery?.level,\n            chargingTime: battery?.chargingTime,\n            dischargingTime: battery?.dischargingTime,\n          };\n        })\n        .catch((error) => {\n          console.warn(\"Battery status API error:\", error);\n          this.batteryStatus = undefined;\n        });\n    } catch (error) {\n      console.warn(\"Unexpected error in battery status check:\", error);\n    }\n  }\n\n  private refreshStorageEstimate(): void {\n    try {\n      // Check if API exists\n      if (!(\"storage\" in navigator && \"estimate\" in navigator.storage)) {\n        return;\n      }\n\n      // Set a timeout to prevent hanging\n      const timeoutPromise = new Promise<null>((_, reject) => {\n        setTimeout(() => reject(new Error(\"Storage estimate timeout\")), 2000);\n      });\n\n      // Race with actual storage estimate fetch\n      Promise.race([\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        (navigator as any).storage.estimate(),\n        timeoutPromise,\n      ])\n        .then((storage: StorageEstimate) => {\n          this.storageEstimate = {\n            quota: storage.quota,\n            usage: storage.usage,\n          };\n        })\n        .catch((error) => {\n          console.warn(\"Storage estimation API error:\", error);\n          this.storageEstimate = undefined;\n        });\n    } catch (error) {\n      console.warn(\"Unexpected error in storage estimation check:\", error);\n    }\n  }\n\n  private truncateString(s: string | undefined, length: number) {\n    if (!s) {\n      return \"\";\n    }\n    if (s.length <= length) {\n      return s;\n    }\n    return s.slice(0, length) + `...(truncated from ${s.length} characters)`;\n  }\n}\n\ninterface ErrorInfo {\n  source?: string;\n  lineno?: number;\n  colno?: number;\n  type?: string;\n}\n\ninterface BatteryStatus {\n  charging?: boolean;\n  level?: number;\n  chargingTime?: number;\n  dischargingTime?: number;\n}\n\ninterface StorageEstimate {\n  quota?: number;\n  usage?: number;\n}\n","import {\n  Activity,\n  ActivityEvent,\n  ActivityType,\n  ActivityLifecycleEvent,\n  ActivityResultsEvent,\n  CallbackOptions,\n  IDataStore,\n  Timer,\n  FontAsset,\n  Uuid,\n  M2EventType,\n  Constants,\n  M2EventListener,\n  Game,\n  M2c2KitHelpers,\n  M2Error,\n} from \"@m2c2kit/core\";\nimport { DomHelper } from \"./DomHelper\";\nimport { SessionOptions } from \"./SessionOptions\";\nimport { SessionLifecycleEvent } from \"./SessionLifecycleEvent\";\nimport { SessionEvent, SessionEventType } from \"./SessionEvent\";\nimport { m2c2kitCss } from \"./m2c2kitCss\";\nimport { SessionDataEvent } from \"./SessionDataEvent\";\nimport { DiagnosticsReporter } from \"./DiagnosticsReporter\";\n\nexport class Session {\n  options: SessionOptions;\n  currentActivity?: Activity;\n  private _uuid?: string;\n  dataStores?: IDataStore[];\n  private eventListeners = new Array<\n    M2EventListener<SessionEvent | ActivityEvent>\n  >();\n  private sessionDictionary = new Map<string, SessionDictionaryValues>();\n  private initialized = false;\n  private diagnosticsReporter?: DiagnosticsReporter;\n\n  /**\n   * A Session contains one or more activities. The session manages the start\n   * and stop of activities, and advancement to next activity\n   *\n   * @param options\n   */\n  constructor(options: SessionOptions) {\n    this.options = options;\n\n    // Make session also available on window in case we want to control or inspect it\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    (window as unknown as any).m2c2kitSession = this;\n\n    this.addDebuggingTools();\n  }\n\n  /**\n   * Adds debugging tools to the session.\n   *\n   * @remarks These tools can be activated by appending query parameters to the\n   * URL or by setting game parameters via the `Game.SetParameters()` method\n   * (only eruda and scripts can be set with `Game.SetParameters()`).\n   */\n  private addDebuggingTools() {\n    const urlParams = new URLSearchParams(window.location.search);\n\n    const diagnosticsUrlParam = urlParams.get(\"diagnostics\");\n    if (diagnosticsUrlParam !== null) {\n      // URL parameter exists - it overrides session options\n      if (diagnosticsUrlParam === \"true\") {\n        this.startDiagnostics();\n      }\n      // If \"false\", don't start diagnostics regardless of session options\n    } else if (this.options.diagnostics === true) {\n      // No URL parameter - fall back to session options\n      this.startDiagnostics();\n    }\n\n    if (urlParams.get(\"eruda\") === \"true\") {\n      M2c2KitHelpers.loadEruda();\n    }\n\n    const scriptsParam = urlParams.get(\"scripts\");\n    if (scriptsParam) {\n      try {\n        const scripts = JSON.parse(\n          decodeURIComponent(scriptsParam),\n        ) as string[];\n        M2c2KitHelpers.loadScriptUrls(scripts);\n      } catch {\n        console.log(\n          `Error parsing \"scripts\" parameter. \"scripts\" must be an array of URL strings, and it is recommended to be URI encoded.`,\n        );\n      }\n    }\n  }\n\n  /**\n   * Starts the diagnostics reporter.\n   */\n  private startDiagnostics() {\n    if (this.diagnosticsReporter) {\n      this.diagnosticsReporter.stop();\n    }\n\n    this.diagnosticsReporter = new DiagnosticsReporter({\n      getSessionUuid: () => this.uuid,\n      getCurrentActivity: () => this.currentActivity,\n      dispatchEvent: this.raiseEventOnListeners.bind(this),\n      onErrorDialogConfirm: this.end.bind(this),\n    });\n    this.diagnosticsReporter.start();\n  }\n\n  /**\n   * Executes a callback when the session initializes.\n   *\n   * @param callback - function to execute.\n   * @param options - options for the callback.\n   */\n  onInitialize(\n    callback: (sessionLifecycleEvent: SessionLifecycleEvent) => void,\n    options?: CallbackOptions,\n  ): void {\n    this.addEventListener(\n      SessionEventType.SessionInitialize,\n      callback,\n      options,\n    );\n  }\n\n  /**\n   * Executes a callback when the session starts.\n   *\n   * @param callback - function to execute.\n   * @param options - options for the callback.\n   */\n  onStart(\n    callback: (sessionLifecycleEvent: SessionLifecycleEvent) => void,\n    options?: CallbackOptions,\n  ): void {\n    this.addEventListener(SessionEventType.SessionStart, callback, options);\n  }\n\n  /**\n   * Executes a callback when the session ends.\n   *\n   * @param callback - function to execute.\n   * @param options - options for the callback.\n   */\n  onEnd(\n    callback: (sessionLifecycleEvent: SessionLifecycleEvent) => void,\n    options?: CallbackOptions,\n  ): void {\n    this.addEventListener(SessionEventType.SessionEnd, callback, options);\n  }\n\n  /**\n   * Executes a callback when the session generates data.\n   *\n   * @remarks Currently, this is used only for capturing diagnostics data on\n   * exceptions.\n   *\n   * @param callback - function to execute.\n   * @param options - options for the callback.\n   */\n  onData(\n    callback: (sessionDataEvent: SessionDataEvent) => void,\n    options?: CallbackOptions,\n  ): void {\n    this.addEventListener(SessionEventType.SessionData, callback, options);\n  }\n\n  /**\n   * Executes a callback when any activity in the session generates data.\n   *\n   * @param callback - function to execute.\n   * @param options - options for the callback.\n   */\n  onActivityData(\n    callback: (activityResultsEvent: ActivityResultsEvent) => void,\n    options?: CallbackOptions,\n  ): void {\n    this.addEventListener(M2EventType.ActivityData, callback, options);\n  }\n\n  private addEventListener<T extends SessionEvent | ActivityEvent>(\n    type: M2EventType | SessionEventType,\n    callback: (ev: T) => void,\n    options?: CallbackOptions,\n  ): void {\n    const eventListener: M2EventListener<T> = {\n      type: type,\n      callback: callback,\n      key: options?.key,\n    };\n\n    if (options?.replaceExisting) {\n      this.eventListeners = this.eventListeners.filter(\n        (listener) => !(listener.type === eventListener.type),\n      );\n    }\n    this.eventListeners.push(\n      eventListener as M2EventListener<SessionEvent | ActivityEvent>,\n    );\n  }\n\n  private raiseEventOnListeners(\n    event: SessionEvent | ActivityEvent,\n    extra?: unknown,\n  ): void {\n    if (extra) {\n      event = {\n        ...event,\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        ...(extra as any),\n      };\n    }\n    // To maintain loose coupling, the DiagnosticReporter does not\n    // depend on the Session class. Instead, it uses the event system to\n    // communicate with the session. Thus, we need to check if the event is\n    // a SessionDataEvent and if the target is not set. If it is not set,\n    // we set it to this session.\n    if (this.eventIsSessionDataEventMissingTarget(event)) {\n      event.target = this;\n    }\n    this.eventListeners\n      .filter((listener) => listener.type === event.type)\n      .forEach((listener) => {\n        listener.callback(event);\n      });\n  }\n\n  private eventIsSessionDataEventMissingTarget(\n    event: SessionEvent | ActivityEvent,\n  ): boolean {\n    return (\n      event.type === SessionEventType.SessionData &&\n      (event as SessionDataEvent).dataType === \"Diagnostics\" &&\n      !event.target\n    );\n  }\n\n  private async sessionActivityStartHandler(event: ActivityLifecycleEvent) {\n    const activityType =\n      event.target.type === ActivityType.Game ? \"game\" : \"survey\";\n    console.log(`ðŸŸ¢ started activity (${activityType}) ${event.target.name}`);\n  }\n\n  private async sessionActivityCancelHandler(event: ActivityLifecycleEvent) {\n    const activityType =\n      event.target.type === ActivityType.Game ? \"game\" : \"survey\";\n    console.log(`ðŸš« canceled activity (${activityType}) ${event.target.name}`);\n\n    if (this.nextActivity && this.options.autoGoToNextActivity !== false) {\n      await this.goToNextActivity();\n      // Note: important to return here, because now this.nextActivity refers\n      // to the activity AFTER the one we have just advanced to.\n      return;\n    }\n    if (!this.nextActivity && this.options.autoEndAfterLastActivity !== false) {\n      this.end();\n    }\n  }\n\n  private async sessionActivityEndHandler(event: ActivityLifecycleEvent) {\n    const activityType =\n      event.target.type === ActivityType.Game ? \"game\" : \"survey\";\n    console.log(`ðŸ”´ ended activity (${activityType}) ${event.target.name}`);\n    if (this.nextActivity && this.options.autoGoToNextActivity !== false) {\n      await this.goToNextActivity();\n      // Note: important to return here, because now this.nextActivity refers\n      // to the activity AFTER the one we have just advanced to.\n      return;\n    }\n    if (!this.nextActivity && this.options.autoEndAfterLastActivity !== false) {\n      this.end();\n    }\n  }\n\n  private async sessionActivityLifecycleHandler(event: ActivityLifecycleEvent) {\n    if (event.type === M2EventType.ActivityStart) {\n      await this.sessionActivityStartHandler(event);\n      return;\n    }\n\n    if (event.type === M2EventType.ActivityCancel) {\n      await this.sessionActivityCancelHandler(event);\n      return;\n    }\n\n    if (event.type === M2EventType.ActivityEnd) {\n      await this.sessionActivityEndHandler(event);\n      return;\n    }\n\n    throw new M2Error(\"unknown activity lifecycle event type\");\n  }\n\n  private activityResultsEventHandler(event: ActivityResultsEvent) {\n    this.raiseEventOnListeners(event);\n  }\n\n  /**\n   * Asynchronously initializes the m2c2kit engine and loads assets\n   *\n   * @deprecated Use Session.initialize() instead.\n   */\n  async init(): Promise<void> {\n    console.warn(\n      `The init() method of Session is deprecated. Use initialize() instead.`,\n    );\n    return this.initialize();\n  }\n\n  /**\n   * Check if the Activity uses the deprecated init() method.\n   *\n   * @remarks Activity.init() is deprecated and should be replaced with\n   * Activity.initialize().\n   *\n   * @param activity\n   * @returns true if the activity defines its own init() method, false otherwise.\n   */\n  private activityUsesDeprecatedInit(activity: Activity): boolean {\n    if (activity.type === ActivityType.Survey) {\n      return false;\n    }\n    const activityPrototype = Object.getPrototypeOf(activity);\n    const gamePrototype = Object.getPrototypeOf(activityPrototype);\n    return activityPrototype?.init !== gamePrototype?.init;\n  }\n\n  /**\n   * Asynchronously initializes the m2c2kit engine and loads assets\n   */\n  async initialize(): Promise<void> {\n    Timer.startNew(\"sessionInitialize\");\n\n    if (this.options.sessionUuid) {\n      this.uuid = this.options.sessionUuid;\n    } else {\n      this.uuid = Uuid.generate();\n    }\n\n    for (const activity of this.options.activities) {\n      if (this.options.activities.filter((a) => a === activity).length > 1) {\n        throw new M2Error(\n          `error in SessionOptions.activities: an instance of the activity named \"${activity.name}\" has been added more than once to the session. If you want to repeat the same activity, create separate instances of it.`,\n        );\n      }\n      activity.sessionUuid = this.uuid;\n      if (this.options.activityCallbacks?.onActivityLifecycle) {\n        activity.onStart(this.options.activityCallbacks.onActivityLifecycle);\n        activity.onCancel(this.options.activityCallbacks.onActivityLifecycle);\n        activity.onEnd(this.options.activityCallbacks.onActivityLifecycle);\n      }\n      if (this.options.activityCallbacks?.onActivityResults) {\n        activity.onData(this.options.activityCallbacks.onActivityResults);\n      }\n\n      if (activity.type === ActivityType.Game) {\n        const game = activity as Game;\n        game.onWarmupStart(() => {\n          DomHelper.setCanvasOverlayVisibility(true);\n        });\n        game.onWarmupEnd(() => {\n          DomHelper.setCanvasOverlayVisibility(false);\n          DomHelper.setBusyAnimationVisibility(false);\n        });\n      }\n    }\n\n    const sessionInitializeEvent: SessionEvent = {\n      target: this,\n      type: SessionEventType.SessionInitialize,\n      ...M2c2KitHelpers.createTimestamps(),\n    };\n    this.raiseEventOnListeners(sessionInitializeEvent);\n    const rootId =\n      this.options.rootElementId ?? Constants.DEFAULT_ROOT_ELEMENT_ID;\n    const root = document.getElementById(rootId);\n    if (!root) {\n      throw new M2Error(\n        `Session.initialize(): root element with id ${rootId} not found. The index.html should have: <div id=\"${rootId}\"></div>.`,\n      );\n    }\n    DomHelper.createRoot(root);\n    DomHelper.addStyleSheet(this.options.styleSheet ?? m2c2kitCss);\n    DomHelper.addLoadingElements();\n    DomHelper.setBusyAnimationVisibility(true);\n    DomHelper.setCanvasOverlayVisibility(true);\n\n    this.dataStores = this.options.dataStores;\n    if (this.dataStores?.length === 0) {\n      throw new M2Error(\n        \"Session.initialize(): dataStores must be undefined or a non-zero array of datastores.\",\n      );\n    }\n\n    await this.getSharedAssets(this.options.activities);\n\n    await Promise.all(\n      this.options.activities.map((activity) => {\n        activity.studyId = this.options.studyId;\n        activity.studyUuid = this.options.studyUuid;\n        // IDataStore implementation is provided by another library and must\n        // be set in the session before calling session.initialize()\n        activity.dataStores = this.dataStores;\n        activity.onStart(this.sessionActivityLifecycleHandler.bind(this));\n        activity.onCancel(this.sessionActivityLifecycleHandler.bind(this));\n        activity.onEnd(this.sessionActivityLifecycleHandler.bind(this));\n        activity.onData((event: ActivityResultsEvent) => {\n          this.activityResultsEventHandler(event);\n        });\n\n        if (this.activityUsesDeprecatedInit(activity)) {\n          console.warn(\n            `game ${activity.id}: Activity.init() is deprecated. In the assessment class that extends Game, use Activity.initialize() instead:\\n  async initialize() {\\n    await super.initialize();\\n    ...\\n  }\\n`,\n          );\n          return activity.init();\n        }\n        return activity.initialize();\n      }),\n    );\n\n    console.log(\n      `âšª Session.initialize() took ${Timer.elapsed(\n        \"sessionInitialize\",\n      ).toFixed(0)} ms`,\n    );\n    Timer.remove(\"sessionInitialize\");\n    this.initialized = true;\n    if (this.options.autoStartAfterInit !== false) {\n      await this.start();\n    }\n  }\n\n  /**\n   * Asynchronously loads fonts and wasm binaries that are common across two\n   * or more game activities and shares them with the games.\n   *\n   * @param activities - array of activities\n   */\n  private async getSharedAssets(activities: Activity[]) {\n    const games = activities.filter(\n      (activity) =>\n        activity.type === ActivityType.Game &&\n        (activity as Game).options.shareAssets !== false,\n    ) as Array<Game>;\n\n    if (games.length > 0) {\n      const manifest = await games[0].loadManifest();\n      games.forEach((game) => {\n        game.manifest = manifest;\n      });\n\n      const wasmPromises = this.initializeSharedCanvasKit(games);\n      const fontPromises = this.fetchSharedFontData(games);\n      await Promise.all([...wasmPromises, ...fontPromises]);\n    }\n  }\n\n  private initializeSharedCanvasKit(games: Game[]) {\n    const sharedWasmVersions = this.getDuplicates(\n      games.map((game) => game.canvasKitWasmVersion),\n    );\n    const wasmAssets = games.map((game) => {\n      return {\n        game: game,\n        version: game.canvasKitWasmVersion,\n        data: undefined,\n      };\n    });\n\n    const wasmPromises = sharedWasmVersions.map(async (sharedWasmVersion) => {\n      const wasmAsset = wasmAssets.filter(\n        (wasm) => wasm.version === sharedWasmVersion,\n      )[0];\n      const game = wasmAsset.game;\n      const baseUrls = await game.resolveGameBaseUrls(game);\n      const canvasKitWasmFilename = `canvaskit-${game.canvasKitWasmVersion}.wasm`;\n      const manifestCanvasKitWasmUrl = M2c2KitHelpers.getUrlFromManifest(\n        game,\n        `${baseUrls.canvasKitWasm}/${canvasKitWasmFilename}`,\n      );\n      console.log(`âšª sharing ${canvasKitWasmFilename} within session`);\n\n      const canvasKit = await game.loadCanvasKit(manifestCanvasKitWasmUrl);\n      games.forEach((game) => {\n        if (game.canvasKitWasmVersion === sharedWasmVersion) {\n          game.canvasKit = canvasKit;\n        }\n      });\n    });\n    return wasmPromises;\n  }\n\n  private fetchSharedFontData(games: Game[]) {\n    const fontFiles = games\n      .flatMap(\n        (game) => game.options.fonts?.filter((f) => f.lazy !== true) ?? [],\n      )\n      .map((fontAsset) => this.getFilenameFromUrl(fontAsset.url));\n    const sharedFontFiles = this.getDuplicates(fontFiles);\n\n    const allGameFonts: Array<GameFontAsset> = games.flatMap((game) => {\n      return (game.options.fonts ?? []).map((fontAsset) => {\n        return {\n          game: game,\n          fontAsset: fontAsset,\n          filename: this.getFilenameFromUrl(fontAsset.url),\n          data: undefined,\n        };\n      });\n    });\n\n    const fontPromises = sharedFontFiles.map(async (sharedFontFile) => {\n      const gameFontAsset = allGameFonts.filter(\n        (gameFont) => gameFont.filename === sharedFontFile,\n      )[0];\n      const game = gameFontAsset.game;\n      const baseUrls = await game.resolveGameBaseUrls(game);\n      const fontUrl = M2c2KitHelpers.getUrlFromManifest(\n        game,\n        `${baseUrls.assets}/${gameFontAsset.fontAsset.url}`,\n      );\n      console.log(\n        `âšª sharing ${this.getFilenameFromUrl(fontUrl)} within session`,\n      );\n\n      const response = await fetch(fontUrl);\n      const fontData = await response.arrayBuffer();\n      games\n        .flatMap((game) => game.options.fonts ?? [])\n        .forEach((fontAsset) => {\n          if (this.getFilenameFromUrl(fontAsset.url) === sharedFontFile) {\n            fontAsset.sharedFont = {\n              url: fontUrl,\n              data: fontData,\n            };\n          }\n        });\n    });\n    return fontPromises;\n  }\n\n  /**\n   * Waits for the session to be initialized.\n   *\n   * @remarks Session.initialize() is asynchronous, and it should be awaited\n   * so that the session is fully initialized before calling Session.start().\n   * If it is not awaited (or it cannot be awaited because the target\n   * environment does not support top-level await), this function ensures that\n   * the session has been initialized.\n   */\n  private async waitForSessionInitialization(): Promise<void> {\n    while (!this.initialized) {\n      await new Promise((resolve) =>\n        setTimeout(\n          resolve,\n          Constants.SESSION_INITIALIZATION_POLLING_INTERVAL_MS,\n        ),\n      );\n    }\n  }\n\n  /**\n   * Starts the session and starts the first activity.\n   */\n  async start(): Promise<void> {\n    await this.waitForSessionInitialization();\n    console.log(\"ðŸŸ¢ started session\");\n    const sessionStartEvent: SessionLifecycleEvent = {\n      target: this,\n      type: SessionEventType.SessionStart,\n      ...M2c2KitHelpers.createTimestamps(),\n    };\n    this.raiseEventOnListeners(sessionStartEvent);\n    this.currentActivity = this.options.activities.find(Boolean);\n    if (this.currentActivity) {\n      DomHelper.configureDomForActivity(this.currentActivity);\n      await this.currentActivity.start();\n    } else {\n      // no activities, so immediately end the session\n      console.warn(\"no activities in session.\");\n      this.end();\n    }\n  }\n\n  /**\n   * Declares the session ended and sends callback.\n   */\n  end(): void {\n    console.log(\"ðŸ”´ ended session\");\n    DomHelper.hideM2c2Elements();\n    this.stop();\n    const sessionEndEvent: SessionLifecycleEvent = {\n      target: this,\n      type: SessionEventType.SessionEnd,\n      ...M2c2KitHelpers.createTimestamps(),\n    };\n    this.raiseEventOnListeners(sessionEndEvent);\n\n    if (this.diagnosticsReporter) {\n      this.diagnosticsReporter.stop();\n      this.diagnosticsReporter = undefined;\n    }\n  }\n\n  private stop(): void {\n    this.dispose();\n  }\n\n  /**\n   * Frees up resources that were allocated to run the session.\n   *\n   * @remarks This will be done automatically by the m2c2kit library;\n   * the end-user must not call this.\n   */\n  private dispose(): void {\n    // TODO: Are there are any other resources that need to be disposed at the session level?\n  }\n\n  /**\n   * Stops the current activity and goes to the activity with the provided id.\n   *\n   * @param options\n   */\n  async goToActivity(options: GoToActivityOptions): Promise<void> {\n    const nextActivity = this.options.activities\n      .filter((activity) => activity.id === options.id)\n      .find(Boolean);\n    if (!nextActivity) {\n      throw new M2Error(\n        `Error in goToActivity(): Session does not contain an activity with id ${options.id}.`,\n      );\n    }\n    if (this.currentActivity) {\n      this.currentActivity.stop();\n    }\n\n    /**\n     * From this point on, the phrase \"currentActivity\" refers to the activity\n     * that we are going to, not the one we are leaving.\n     * currentActivityOldObject is an instance of the activity that has been\n     * fully initialized previously. We use currentActivityOldObject as a\n     * blueprint to create a new instance.\n     */\n    const currentActivityOldObject = nextActivity;\n\n    /**\n     * It is possible the current activity is one we have executed before. In\n     * that case, we need to reset everything about this activity. The cleanest\n     * way to do that is create a new instance of it. The below factory\n     * function does that.\n     * see https://stackoverflow.com/a/14378462\n     */\n    const activityFactoryFunction =\n      currentActivityOldObject.constructor.bind.apply(\n        currentActivityOldObject.constructor,\n        [null],\n      );\n    this.currentActivity = new activityFactoryFunction() as Activity;\n\n    const indexOfCurrentActivity = this.options.activities.indexOf(\n      currentActivityOldObject,\n    );\n    this.options.activities[indexOfCurrentActivity] = this.currentActivity;\n    DomHelper.configureDomForActivity(this.currentActivity);\n\n    /**\n     * Because the current activity has been newly created, it needs properties\n     * assigned to it that it would have received in the Session.initialize()\n     * method. Also, if the old instance had new parameters set via\n     * Game.SetParameters(), we must apply them.\n     */\n    this.currentActivity.dataStores = this.dataStores;\n    /**\n     * IMPORTANT: Originally, we checked if the current activity was a game\n     * by checking if it was an instance of Game. However, if we are mixing\n     * code bundles, the Game class in one bundle will not be the same as the\n     * Game class in another bundle. Instead, we must check the type property\n     * of the activity.\n     */\n    // if (this.currentActivity.type === ActivityType.Game && this.canvasKit) {\n    //   (this.currentActivity as Game).canvasKit = this.canvasKit;\n    // }\n    if (currentActivityOldObject.additionalParameters) {\n      this.currentActivity.setParameters(\n        currentActivityOldObject.additionalParameters,\n      );\n    }\n\n    /**\n     * In Session.initialize(), async assets were loaded. Once processed, they were\n     * stored in a dictionary, with the activity uuid as the key. When a new\n     * instance of the activity is created, the object has a different uuid.\n     * We must update the uuid in the dictionaries (if it exists).\n     */\n    // if (this.imageManager.loadedImages[currentActivityOldObject.uuid]) {\n    //   this.imageManager.loadedImages[this.currentActivity.uuid] =\n    //     this.imageManager.loadedImages[currentActivityOldObject.uuid];\n    //   delete this.imageManager.loadedImages[currentActivityOldObject.uuid];\n    // }\n    // if (this.fontManager.gameTypefaces[currentActivityOldObject.uuid]) {\n    //   this.fontManager.gameTypefaces[this.currentActivity.uuid] =\n    //     this.fontManager.gameTypefaces[currentActivityOldObject.uuid];\n    //   delete this.fontManager.gameTypefaces[currentActivityOldObject.uuid];\n    // }\n\n    await this.currentActivity.initialize();\n    await this.currentActivity.start();\n  }\n\n  /**\n   * Stops the current activity and advances to next activity in the session.\n   * If there is no activity after the current activity, throws error.\n   */\n  async goToNextActivity(): Promise<void> {\n    if (!this.currentActivity) {\n      throw new M2Error(\n        \"error in advanceToNextActivity(): no current activity\",\n      );\n    }\n    if (!this.nextActivity) {\n      throw new M2Error(\"error in advanceToNextActivity(): no next activity\");\n    }\n    this.currentActivity.stop();\n    this.currentActivity = this.nextActivity;\n\n    DomHelper.configureDomForActivity(this.currentActivity);\n    await this.currentActivity.start();\n  }\n\n  /**\n   * Stops the current activity and advances to next activity in the session.\n   * If there is no activity after the current activity, throws error.\n   *\n   * @deprecated Use goToNextActivity() instead.\n   */\n  async advanceToNextActivity(): Promise<void> {\n    await this.goToNextActivity();\n  }\n\n  /**\n   * Gets the next activity after the current one, or undefined if\n   * this is the last activity.\n   */\n  get nextActivity(): Activity | undefined {\n    if (!this.currentActivity) {\n      throw new M2Error(\"error in get nextActivity(): no current activity\");\n    }\n    const index = this.options.activities.indexOf(this.currentActivity);\n    if (index === this.options.activities.length - 1) {\n      return undefined;\n    }\n    const currentActivityIndex = this.options.activities.indexOf(\n      this.currentActivity,\n    );\n    return this.options.activities[currentActivityIndex + 1];\n  }\n\n  /**\n   * Saves an item to the session's key-value dictionary.\n   *\n   * @remarks The session dictionary is not persisted. It is available only\n   * during the actively running session. It is useful for storing temporary\n   * data to coordinate between activities.\n   *\n   * @param key - item key\n   * @param value - item value\n   */\n  dictionarySetItem(key: string, value: SessionDictionaryValues): void {\n    this.sessionDictionary.set(key, value);\n  }\n\n  /**\n   * Gets an item value from the session's key-value dictionary.\n   *\n   * @remarks The session dictionary is not persisted. It is available only\n   * during the actively running session. It is useful for storing temporary\n   * data to coordinate between activities.\n   *\n   * @param key - item key\n   * @returns value of the item\n   */\n  dictionaryGetItem<T extends SessionDictionaryValues>(key: string) {\n    return this.sessionDictionary.get(key) as T;\n  }\n\n  /**\n   * Deletes an item value from the session's key-value dictionary.\n   *\n   * @remarks The session dictionary is not persisted. It is available only\n   * during the actively running session. It is useful for storing temporary\n   * data to coordinate between activities.\n   *\n   * @param key - item key\n   * @returns true if the item was deleted, false if it did not exist\n   */\n  dictionaryDeleteItem(key: string) {\n    return this.sessionDictionary.delete(key);\n  }\n\n  /**\n   * Determines if a key exists in the activity's key-value dictionary.\n   *\n   * @remarks The session dictionary is not persisted. It is available only\n   * during the actively running session. It is useful for storing temporary\n   * data to coordinate between activities.\n   *\n   * @param key - item key\n   * @returns true if the key exists, false otherwise\n   */\n  dictionaryItemExists(key: string) {\n    return this.sessionDictionary.has(key);\n  }\n\n  /**\n   * Returns the filename from a url.\n   *\n   * @param url - url to parse\n   * @returns filename\n   */\n  private getFilenameFromUrl(url: string) {\n    return url.substring(url.lastIndexOf(\"/\") + 1);\n  }\n\n  /**\n   * Returns the duplicated strings in an array.\n   *\n   * @param s - array of strings\n   * @returns array of duplicated strings\n   */\n  private getDuplicates(s: string[]): string[] {\n    const count: { [key: string]: number } = {};\n    const duplicates: string[] = [];\n\n    for (const str of s) {\n      count[str] = (count[str] || 0) + 1;\n      if (count[str] === 2) {\n        duplicates.push(str);\n      }\n    }\n\n    return duplicates;\n  }\n\n  get uuid(): string {\n    if (!this._uuid) {\n      // A UUID is generated in the initialize() method, and this is okay\n      // in most cases because the UUID will not be used until the session\n      // is initialized. However, there is an edge case. If there is an\n      // exception before the session is initialized, the DiagnosticsReporter\n      // class will need a session UUID to report the error. In that case,\n      // use the empty UUID.\n      console.warn(\"Session.uuid is undefined. Returning empty UUID.\");\n      return \"00000000-0000-0000-0000-000000000000\";\n    }\n    return this._uuid;\n  }\n  set uuid(value: string) {\n    this._uuid = value;\n  }\n\n  /**\n   * Sets the value of a variable that will be the same for all diagnostic data.\n   *\n   * @remarks This is useful for custom variables to appear in the diagnostic\n   * data. For example, you might save the subject's participant ID, or some\n   * other identifier that is not typically part of the diagnostic data. In\n   * the example below, if an exception occurs, the `participant_id` variable\n   * will be saved with the value `12345` within the diagnostic data.\n   * \n   * @example\n   * ```\n   * session.addStaticDiagnosticData(\"participant_id\", \"12345\");\n   *```\n\n   * @param key - key (variable name) for the static diagnostic data\n   * @param value - value for the data\n   */\n  addStaticDiagnosticData(\n    key: string,\n    value: string | number | boolean | object | undefined | null,\n  ) {\n    if (this.diagnosticsReporter) {\n      this.diagnosticsReporter.addStaticDiagnosticData(key, value);\n    } else {\n      console.warn(\n        `Session.addStaticDiagnosticData(): diagnostics reporter has not been created.`,\n      );\n    }\n  }\n}\n\nexport interface GoToActivityOptions {\n  /** ActivityId of the activity to go to. */\n  id: string;\n}\n\n/**\n * Types of values that can be stored in the session dictionary.\n */\nexport type SessionDictionaryValues =\n  | string\n  | number\n  | boolean\n  | object\n  | null\n  | undefined;\n\ninterface GameFontAsset {\n  game: Game;\n  fontAsset: FontAsset;\n  filename: string;\n  data: ArrayBuffer | undefined;\n}\n","export * from \"./Session\";\nexport * from \"./SessionEvent\";\nexport * from \"./SessionOptions\";\nexport * from \"./SessionLifecycleEvent\";\nexport * from \"./DomHelper\";\n\nconsole.log(\"âšª @m2c2kit/session version __PACKAGE_JSON_VERSION__\");\n"],"names":["game"],"mappings":"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"}